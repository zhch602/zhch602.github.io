<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    InJune&#39;s Blog
</title>
<link rel="shortcut icon" href="https://zhch602.github.io/favicon.ico?v=1573736033730">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zhch602.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://zhch602.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139615634-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-139615634-1');
    </script>
    
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://zhch602.github.io">
                <img class="avatar" src="https://zhch602.github.io/images/avatar.png?v=1573736033730" alt="">
            </a>
            <div class="site-title">
                <h1>
                    InJune&#39;s Blog
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    é¦–é¡µ
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    å½’æ¡£
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    æ ‡ç­¾
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    å…³äº
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-container main-container">
                <div id="content" class="main-container-left">
                    
        
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zhch602.github.io/post/h_CWNn_AO">
                        Markdown åŸºæœ¬è¯­æ³•
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2019-11-14</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            ä¸»è¦å†…å®¹

Markdownæ˜¯ä»€ä¹ˆï¼Ÿ
è°åˆ›é€ äº†å®ƒï¼Ÿ
ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ
æ€ä¹ˆä½¿ç”¨ï¼Ÿ
è°åœ¨ç”¨ï¼Ÿ
å°è¯•ä¸€ä¸‹

æ­£æ–‡
1. Markdownæ˜¯ä»€ä¹ˆï¼Ÿ
Markdownæ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒä»¥çº¯æ–‡æœ¬å½¢å¼(æ˜“è¯»ã€æ˜“å†™ã€æ˜“æ›´æ”¹)ç¼–å†™æ–‡æ¡£ï¼Œå¹¶æœ€ç»ˆä»¥HTMLæ ¼å¼å‘å¸ƒã€‚
Markdownä¹Ÿå¯ä»¥ç†è§£ä¸ºå°†ä»¥MARKDOWNè¯­æ³•ç¼–å†™çš„è¯­è¨€è½¬æ¢æˆHTMLå†…å®¹çš„å·¥å…·ã€‚
2. è°åˆ›é€ äº†å®ƒï¼Ÿ
å®ƒç”±Aaron Swartzå’ŒJohn Gruberå…±åŒè®¾è®¡ï¼ŒAaron Swartzå°±æ˜¯é‚£ä½äºå»å¹´ï¼ˆ2013å¹´1æœˆ11æ—¥ï¼‰è‡ªæ€,æœ‰ç€å¼€æŒ‚ä¸€èˆ¬äººç”Ÿç»å†çš„ç¨‹åºå‘˜ã€‚ç»´åŸºç™¾ç§‘å¯¹ä»–çš„ä»‹ç»æ˜¯ï¼šè½¯ä»¶å·¥ç¨‹å¸ˆã€ä½œå®¶ã€æ”¿æ²»ç»„ç»‡è€…ã€äº’è”ç½‘æ´»åŠ¨å®¶ã€ç»´åŸºç™¾ç§‘äººã€‚
ä»–æœ‰ç€è¶³ä»¥è®©ä½ è·ªæ‹œçš„äººç”Ÿç»å†ï¼š

14å²å‚ä¸RSS 1.0è§„æ ¼æ ‡å‡†çš„åˆ¶è®¢ã€‚
2004å¹´å…¥è¯»æ–¯å¦ç¦ï¼Œä¹‹åé€€å­¦ã€‚
2005å¹´åˆ›å»ºInfogamiï¼Œä¹‹åä¸Redditåˆå¹¶æˆä¸ºå…¶åˆä¼™äººã€‚
2010å¹´åˆ›ç«‹æ±‚è¿›ä¼šï¼ˆDemand Progressï¼‰ï¼Œç§¯æå‚ä¸ç¦æ­¢ç½‘ç»œç›—ç‰ˆæ³•æ¡ˆï¼ˆSOPAï¼‰æ´»åŠ¨ï¼Œæœ€ç»ˆè¯¥ææ¡ˆè¢«æ’¤å›ã€‚
2011å¹´7æœˆ19æ—¥ï¼Œå› è¢«æ§ä»MITå’ŒJSTORä¸‹è½½480ä¸‡ç¯‡å­¦æœ¯è®ºæ–‡å¹¶ä»¥å…è´¹å½¢å¼ä¸Šä¼ äºç½‘ç»œè¢«æ•ã€‚
2013å¹´1æœˆè‡ªæ€èº«äº¡ã€‚


å¤©æ‰éƒ½æœ‰æ—©é€çš„å½’é€”ã€‚
3. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ

å®ƒæ˜¯æ˜“è¯»ï¼ˆçœ‹èµ·æ¥èˆ’æœï¼‰ã€æ˜“å†™ï¼ˆè¯­æ³•ç®€å•ï¼‰ã€æ˜“æ›´æ”¹çº¯æ–‡æœ¬ã€‚å¤„å¤„ä½“ç°ç€æç®€ä¸»ä¹‰çš„å½±å­ã€‚
å…¼å®¹HTMLï¼Œå¯ä»¥è½¬æ¢ä¸ºHTMLæ ¼å¼å‘å¸ƒã€‚
è·¨å¹³å°ä½¿ç”¨ã€‚
è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™æ”¯æŒMarkdownã€‚
æ›´æ–¹ä¾¿æ¸…æ™°åœ°ç»„ç»‡ä½ çš„ç”µå­é‚®ä»¶ã€‚ï¼ˆMarkdown-here, Airmailï¼‰
æ‘†è„±Wordï¼ˆæˆ‘ä¸æ˜¯è®¤çœŸçš„ï¼‰ã€‚

4. æ€ä¹ˆä½¿ç”¨ï¼Ÿ
å¦‚æœä¸ç®—æ‰©å±•ï¼ŒMarkdownçš„è¯­æ³•ç»å¯¹ç®€å•åˆ°è®©ä½ çˆ±ä¸é‡Šæ‰‹ã€‚
Markdownè¯­æ³•ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ å¤§éƒ¨åˆ†ï¼š
æ ‡é¢˜ï¼Œæ®µè½ï¼ŒåŒºå—å¼•ç”¨ï¼Œä»£ç åŒºå—ï¼Œå¼ºè°ƒï¼Œåˆ—è¡¨ï¼Œåˆ†å‰²çº¿ï¼Œé“¾æ¥ï¼Œå›¾ç‰‡ï¼Œåæ–œæ  \ï¼Œç¬¦å·&#39;`&#39;ã€‚
4.1 æ ‡é¢˜
ä¸¤ç§å½¢å¼ï¼š
1ï¼‰ä½¿ç”¨=å’Œ-æ ‡è®°ä¸€çº§å’ŒäºŒçº§æ ‡é¢˜ã€‚

ä¸€çº§æ ‡é¢˜
=========
äºŒçº§æ ‡é¢˜
---------

æ•ˆæœï¼š

ä¸€çº§æ ‡é¢˜
äºŒçº§æ ‡é¢˜

2ï¼‰ä½¿ç”¨#ï¼Œå¯è¡¨ç¤º1-6çº§æ ‡é¢˜ã€‚

# ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
### ä¸‰çº§æ ‡é¢˜
#### å››çº§æ ‡é¢˜
##### äº”çº§æ ‡é¢˜
###### å…­çº§æ ‡é¢˜

æ•ˆæœï¼š

ä¸€çº§æ ‡é¢˜
äºŒçº§æ ‡é¢˜
ä¸‰çº§æ ‡é¢˜
å››çº§æ ‡é¢˜
äº”çº§æ ‡é¢˜
å…­çº§æ ‡é¢˜

4.2 æ®µè½
æ®µè½çš„å‰åè¦æœ‰ç©ºè¡Œï¼Œæ‰€è°“çš„ç©ºè¡Œæ˜¯æŒ‡æ²¡æœ‰æ–‡å­—å†…å®¹ã€‚è‹¥æƒ³åœ¨æ®µå†…å¼ºåˆ¶æ¢è¡Œçš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸¤ä¸ªä»¥ä¸Šç©ºæ ¼åŠ ä¸Šå›è½¦ï¼ˆå¼•ç”¨ä¸­æ¢è¡Œçœç•¥å›è½¦ï¼‰ã€‚
4.3 åŒºå—å¼•ç”¨
åœ¨æ®µè½çš„æ¯è¡Œæˆ–è€…åªåœ¨ç¬¬ä¸€è¡Œä½¿ç”¨ç¬¦å·&amp;gt;,è¿˜å¯ä½¿ç”¨å¤šä¸ªåµŒå¥—å¼•ç”¨ï¼Œå¦‚ï¼š

&amp;gt; åŒºå—å¼•ç”¨
&amp;gt;&amp;gt; åµŒå¥—å¼•ç”¨

æ•ˆæœï¼š

åŒºå—å¼•ç”¨

åµŒå¥—å¼•ç”¨


4.4 ä»£ç åŒºå—
ä»£ç åŒºå—çš„å»ºç«‹æ˜¯åœ¨æ¯è¡ŒåŠ ä¸Š4ä¸ªç©ºæ ¼æˆ–è€…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆå¦‚åŒå†™ä»£ç ä¸€æ ·ï¼‰ã€‚å¦‚
æ™®é€šæ®µè½ï¼š
void main()
{
printf(&amp;quot;Hello, Markdown.&amp;quot;);
}
ä»£ç åŒºå—ï¼š
void main()
{
    printf(&amp;quot;Hello, Markdown.&amp;quot;);
}

æ³¨æ„:éœ€è¦å’Œæ™®é€šæ®µè½ä¹‹é—´å­˜åœ¨ç©ºè¡Œã€‚
4.5 å¼ºè°ƒ
åœ¨å¼ºè°ƒå†…å®¹ä¸¤ä¾§åˆ†åˆ«åŠ ä¸Š*æˆ–è€…_ï¼Œå¦‚ï¼š

*æ–œä½“*ï¼Œ_æ–œä½“_
**ç²—ä½“**ï¼Œ__ç²—ä½“__

æ•ˆæœï¼š

æ–œä½“ï¼Œæ–œä½“
ç²—ä½“ï¼Œç²—ä½“

4.6 åˆ—è¡¨
ä½¿ç”¨Â·ã€+ã€æˆ–-æ ‡è®°æ— åºåˆ—è¡¨ï¼Œå¦‚ï¼š

-ï¼ˆ+*ï¼‰ ç¬¬ä¸€é¡¹
-ï¼ˆ+*ï¼‰ ç¬¬äºŒé¡¹
- ï¼ˆ+*ï¼‰ç¬¬ä¸‰é¡¹

æ³¨æ„ï¼šæ ‡è®°åé¢æœ€å°‘æœ‰ä¸€ä¸ª_ç©ºæ ¼_æˆ–_åˆ¶è¡¨ç¬¦_ã€‚è‹¥ä¸åœ¨å¼•ç”¨åŒºå—ä¸­ï¼Œå¿…é¡»å’Œå‰æ–¹æ®µè½ä¹‹é—´å­˜åœ¨ç©ºè¡Œã€‚
æ•ˆæœï¼š


ç¬¬ä¸€é¡¹
ç¬¬äºŒé¡¹
ç¬¬ä¸‰é¡¹


æœ‰åºåˆ—è¡¨çš„æ ‡è®°æ–¹å¼æ˜¯å°†ä¸Šè¿°çš„ç¬¦å·æ¢æˆæ•°å­—,å¹¶è¾…ä»¥.ï¼Œå¦‚ï¼š

1 . ç¬¬ä¸€é¡¹
2 . ç¬¬äºŒé¡¹
3 . ç¬¬ä¸‰é¡¹

æ•ˆæœï¼š


ç¬¬ä¸€é¡¹
ç¬¬äºŒé¡¹
ç¬¬ä¸‰é¡¹


4.7 åˆ†å‰²çº¿
åˆ†å‰²çº¿æœ€å¸¸ä½¿ç”¨å°±æ˜¯ä¸‰ä¸ªæˆ–ä»¥ä¸Š*ï¼Œè¿˜å¯ä»¥ä½¿ç”¨-å’Œ_ã€‚
4.8 é“¾æ¥
é“¾æ¥å¯ä»¥ç”±ä¸¤ç§å½¢å¼ç”Ÿæˆï¼šè¡Œå†…å¼å’Œå‚è€ƒå¼ã€‚
è¡Œå†…å¼ï¼š

[younghzçš„Markdownåº“](https:ğŸ˜•/github.com/younghz/Markdown &amp;quot;Markdown&amp;quot;)ã€‚

æ•ˆæœï¼š

younghzçš„Markdownåº“ã€‚

å‚è€ƒå¼ï¼š

[younghzçš„Markdownåº“1][1]
[younghzçš„Markdownåº“2][2]
[1]:https:ğŸ˜•/github.com/younghz/Markdown &amp;quot;Markdown&amp;quot;
[2]:https:ğŸ˜•/github.com/younghz/Markdown &amp;quot;Markdown&amp;quot;

æ•ˆæœï¼š

younghzçš„Markdownåº“1
younghzçš„Markdownåº“2

æ³¨æ„ï¼šä¸Šè¿°çš„[1]:https:://github.com/younghz/Markdown &amp;quot;Markdown&amp;quot;ä¸å‡ºç°åœ¨åŒºå—ä¸­ã€‚
4.9 å›¾ç‰‡
æ·»åŠ å›¾ç‰‡çš„å½¢å¼å’Œé“¾æ¥ç›¸ä¼¼ï¼Œåªéœ€åœ¨é“¾æ¥çš„åŸºç¡€ä¸Šå‰æ–¹åŠ ä¸€ä¸ªï¼ã€‚
4.10 åæ–œæ \
ç›¸å½“äºåè½¬ä¹‰ä½œç”¨ã€‚ä½¿ç¬¦å·æˆä¸ºæ™®é€šç¬¦å·ã€‚
4.11 ç¬¦å·&#39;`&#39;
èµ·åˆ°æ ‡è®°ä½œç”¨ã€‚å¦‚ï¼š

`ctrl+a`

æ•ˆæœï¼š

ctrl+a

5. è°åœ¨ç”¨ï¼Ÿ
Markdownçš„ä½¿ç”¨è€…ï¼š

GitHub
ç®€ä¹¦
Stack Overflow
Apollo
Moodle
Reddit
ç­‰ç­‰

6. å°è¯•ä¸€ä¸‹

Chromeä¸‹çš„æ’ä»¶è¯¸å¦‚stackeditä¸markdown-hereç­‰éå¸¸æ–¹ä¾¿ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå¹³å°å—é™ã€‚
åœ¨çº¿çš„dillinger.ioè¯„ä»·ä¹Ÿä¸é”™
Windownsä¸‹çš„MarkdownPadä¹Ÿç”¨è¿‡ï¼Œä¸è¿‡å…è´¹ç‰ˆçš„ä½“éªŒä¸æ˜¯å¾ˆå¥½ã€‚
Macä¸‹çš„Mouæ˜¯å›½äººè´¡çŒ®çš„ï¼Œå£ç¢‘å¾ˆå¥½ã€‚
Linuxä¸‹çš„ReTextä¸é”™ã€‚

å½“ç„¶ï¼Œæœ€ç»ˆå¢ƒç•Œæ°¸è¿œéƒ½æ˜¯ç¬”ä¸‹æ˜¯è¯­æ³•ï¼Œå¿ƒä¸­æ ¼å¼åŒ– ğŸ˜ƒã€‚

æ³¨æ„ï¼šä¸åŒçš„Markdownè§£é‡Šå™¨æˆ–å·¥å…·å¯¹ç›¸åº”è¯­æ³•ï¼ˆæ‰©å±•è¯­æ³•ï¼‰çš„è§£é‡Šæ•ˆæœä¸å°½ç›¸åŒï¼Œå…·ä½“å¯å‚è§å·¥å…·çš„ä½¿ç”¨è¯´æ˜ã€‚
è™½ç„¶æœ‰äººæƒ³å‡ºé¢æä¸€ä¸ªæ‰€è°“çš„æ ‡å‡†åŒ–çš„Markdownï¼Œ[æ²¡æƒ³åˆ°è¿˜æƒ¹æ€’äº†å¥åœ¨çš„åˆ›å§‹äººJohn Gruber]
(http://blog.codinghorror.com/standard-markdown-is-now-common-markdown/ )ã€‚

ä»¥ä¸ŠåŸºæœ¬æ˜¯æ‰€æœ‰traditonal markdownçš„è¯­æ³•ã€‚
å…¶å®ƒï¼š
åˆ—è¡¨çš„ä½¿ç”¨(étraditonal markdown)ï¼š
ç”¨|è¡¨ç¤ºè¡¨æ ¼çºµå‘è¾¹ç•Œï¼Œè¡¨å¤´å’Œè¡¨å†…å®¹ç”¨-éš”å¼€ï¼Œå¹¶å¯ç”¨:è¿›è¡Œå¯¹é½è®¾ç½®ï¼Œä¸¤è¾¹éƒ½æœ‰:åˆ™è¡¨ç¤ºå±…ä¸­ï¼Œè‹¥ä¸åŠ :åˆ™é»˜è®¤å·¦å¯¹é½ã€‚



ä»£ç åº“
é“¾æ¥




MarkDown
https://github.com/younghz/Markdown


MarkDownCopy
https://github.com/younghz/Markdown



å…³äºå…¶å®ƒæ‰©å±•è¯­æ³•å¯å‚è§å…·ä½“å·¥å…·çš„ä½¿ç”¨è¯´æ˜ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zhch602.github.io/post/h_CWNn_AO">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zhch602.github.io/post/qing-liang-ji-fen-bu-shi-rpc-kuang-jia">
                        è½»é‡çº§åˆ†å¸ƒå¼ RPC æ¡†æ¶
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2019-05-06</time>
                    
                        <a href="https://zhch602.github.io/tag/imQ_OK1Mz" class="post-tag i-tag
                            i-tag-error">
            #java
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            RPCï¼Œå³ Remote Procedure Callï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œè¯´å¾—é€šä¿—ä¸€ç‚¹å°±æ˜¯ï¼šè°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸Šçš„æœåŠ¡ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¸€æ ·ã€‚
RPC å¯åŸºäº HTTP æˆ– TCP åè®®ï¼ŒWeb Service å°±æ˜¯åŸºäº HTTP åè®®çš„ RPCï¼Œå®ƒå…·æœ‰è‰¯å¥½çš„è·¨å¹³å°æ€§ï¼Œä½†å…¶æ€§èƒ½å´ä¸å¦‚åŸºäº TCP åè®®çš„ RPCã€‚ä¼šä¸¤æ–¹é¢ä¼šç›´æ¥å½±å“ RPC çš„æ€§èƒ½ï¼Œä¸€æ˜¯ä¼ è¾“æ–¹å¼ï¼ŒäºŒæ˜¯åºåˆ—åŒ–ã€‚
ä¼—æ‰€å‘¨çŸ¥ï¼ŒTCP æ˜¯ä¼ è¾“å±‚åè®®ï¼ŒHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œè€Œä¼ è¾“å±‚è¾ƒåº”ç”¨å±‚æ›´åŠ åº•å±‚ï¼Œåœ¨æ•°æ®ä¼ è¾“æ–¹é¢ï¼Œè¶Šåº•å±‚è¶Šå¿«ï¼Œå› æ­¤ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒTCP ä¸€å®šæ¯” HTTP å¿«ã€‚å°±åºåˆ—åŒ–è€Œè¨€ï¼ŒJava æä¾›äº†é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼ï¼Œä½†åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹å¼å°†ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½ä¸Šçš„ç“¶é¢ˆï¼Œäºæ˜¯å¸‚é¢ä¸Šå‡ºç°äº†ä¸€ç³»åˆ—ä¼˜ç§€çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œæ¯”å¦‚ï¼šProtobufã€Kryoã€Hessianã€Jackson ç­‰ï¼Œå®ƒä»¬å¯ä»¥å–ä»£ Java é»˜è®¤çš„åºåˆ—åŒ–ï¼Œä»è€Œæä¾›æ›´é«˜æ•ˆçš„æ€§èƒ½ã€‚
ä¸ºäº†æ”¯æŒé«˜å¹¶å‘ï¼Œä¼ ç»Ÿçš„é˜»å¡å¼ IO æ˜¾ç„¶ä¸å¤ªåˆé€‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¼‚æ­¥çš„ IOï¼Œå³ NIOã€‚Java æä¾›äº† NIO çš„è§£å†³æ–¹æ¡ˆï¼ŒJava 7 ä¹Ÿæä¾›äº†æ›´ä¼˜ç§€çš„ NIO.2 æ”¯æŒï¼Œç”¨ Java å®ç° NIO å¹¶ä¸æ˜¯é¥ä¸å¯åŠçš„äº‹æƒ…ï¼Œåªæ˜¯éœ€è¦æˆ‘ä»¬ç†Ÿæ‚‰ NIO çš„æŠ€æœ¯ç»†èŠ‚ã€‚
æˆ‘ä»¬éœ€è¦å°†æœåŠ¡éƒ¨ç½²åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡æœåŠ¡æ³¨å†Œçš„æ–¹å¼ï¼Œè®©å®¢æˆ·ç«¯æ¥è‡ªåŠ¨å‘ç°å½“å‰å¯ç”¨çš„æœåŠ¡ï¼Œå¹¶è°ƒç”¨è¿™äº›æœåŠ¡ã€‚è¿™éœ€è¦ä¸€ç§æœåŠ¡æ³¨å†Œè¡¨ï¼ˆService Registryï¼‰çš„ç»„ä»¶ï¼Œè®©å®ƒæ¥æ³¨å†Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ‰€æœ‰çš„æœåŠ¡åœ°å€ï¼ˆåŒ…æ‹¬ï¼šä¸»æœºåä¸ç«¯å£å·ï¼‰ã€‚
åº”ç”¨ã€æœåŠ¡ã€æœåŠ¡æ³¨å†Œè¡¨ä¹‹é—´çš„å…³ç³»è§ä¸‹å›¾ï¼š

æ¯å° Server ä¸Šå¯å‘å¸ƒå¤šä¸ª Serviceï¼Œè¿™äº› Service å…±ç”¨ä¸€ä¸ª host ä¸ portï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¼šæä¾› Server å…±åŒå¯¹å¤–æä¾› Serviceã€‚æ­¤å¤–ï¼Œä¸ºé˜²æ­¢ Service Registry å‡ºç°å•ç‚¹æ•…éšœï¼Œå› æ­¤éœ€è¦å°†å…¶æ­å»ºä¸ºé›†ç¾¤ç¯å¢ƒã€‚
æœ¬æ–‡å°†ä¸ºæ‚¨æ­æ™“å¼€å‘è½»é‡çº§åˆ†å¸ƒå¼ RPC æ¡†æ¶çš„å…·ä½“è¿‡ç¨‹ï¼Œè¯¥æ¡†æ¶åŸºäº TCP åè®®ï¼Œæä¾›äº† NIO ç‰¹æ€§ï¼Œæä¾›é«˜æ•ˆçš„åºåˆ—åŒ–æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿå…·å¤‡æœåŠ¡æ³¨å†Œä¸å‘ç°çš„èƒ½åŠ›ã€‚
æ ¹æ®ä»¥ä¸ŠæŠ€æœ¯éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä½¿ç”¨å¦‚ä¸‹æŠ€æœ¯é€‰å‹ï¼š

Springï¼šå®ƒæ˜¯æœ€å¼ºå¤§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä¹Ÿæ˜¯ä¸šç•Œçš„æƒå¨æ ‡å‡†ã€‚
Nettyï¼šå®ƒä½¿ NIO ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼Œå±è”½äº† Java åº•å±‚çš„ NIO ç»†èŠ‚ã€‚
Protostuffï¼šå®ƒåŸºäº Protobuf åºåˆ—åŒ–æ¡†æ¶ï¼Œé¢å‘ POJOï¼Œæ— éœ€ç¼–å†™ .proto æ–‡ä»¶ã€‚
ZooKeeperï¼šæä¾›æœåŠ¡æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼Œå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¿…å¤‡é€‰æ‹©ï¼ŒåŒæ—¶å®ƒä¹Ÿå…·å¤‡å¤©ç”Ÿçš„é›†ç¾¤èƒ½åŠ›ã€‚

ç›¸å…³ Maven ä¾èµ–è¯·è§é™„å½•ã€‚
&amp;lt;!-- lang: java --&amp;gt;
public interface HelloService {

    String hello(String name);
}

å°†è¯¥æ¥å£æ”¾åœ¨ç‹¬ç«‹çš„å®¢æˆ·ç«¯ jar åŒ…ä¸­ï¼Œä»¥ä¾›åº”ç”¨ä½¿ç”¨ã€‚
&amp;lt;!-- lang: java --&amp;gt;
@RpcService(HelloService.class) // æŒ‡å®šè¿œç¨‹æ¥å£
public class HelloServiceImpl implements HelloService {

    @Override
    public String hello(String name) {
        return &amp;quot;Hello! &amp;quot; + name;
    }
}

ä½¿ç”¨RpcServiceæ³¨è§£å®šä¹‰åœ¨æœåŠ¡æ¥å£çš„å®ç°ç±»ä¸Šï¼Œéœ€è¦å¯¹è¯¥å®ç°ç±»æŒ‡å®šè¿œç¨‹æ¥å£ï¼Œå› ä¸ºå®ç°ç±»å¯èƒ½ä¼šå®ç°å¤šä¸ªæ¥å£ï¼Œä¸€å®šè¦å‘Šè¯‰æ¡†æ¶å“ªä¸ªæ‰æ˜¯è¿œç¨‹æ¥å£ã€‚
RpcServiceä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Component // è¡¨æ˜å¯è¢« Spring æ‰«æ
public @interface RpcService {

    Class&amp;lt;?&amp;gt; value();
}

è¯¥æ³¨è§£å…·å¤‡ Spring çš„Componentæ³¨è§£çš„ç‰¹æ€§ï¼Œå¯è¢« Spring æ‰«æã€‚
è¯¥å®ç°ç±»æ”¾åœ¨æœåŠ¡ç«¯ jar åŒ…ä¸­ï¼Œè¯¥ jar åŒ…è¿˜æä¾›äº†ä¸€äº›æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶ä¸å¯åŠ¨æœåŠ¡çš„å¼•å¯¼ç¨‹åºã€‚
æœåŠ¡ç«¯ Spring é…ç½®æ–‡ä»¶åä¸ºspring.xmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: xml --&amp;gt;
&amp;lt;beans ...&amp;gt;
    &amp;lt;context:component-scan base-package=&amp;quot;com.xxx.rpc.sample.server&amp;quot;/&amp;gt;

    &amp;lt;context:property-placeholder location=&amp;quot;classpath:config.properties&amp;quot;/&amp;gt;

    &amp;lt;!-- é…ç½®æœåŠ¡æ³¨å†Œç»„ä»¶ --&amp;gt;
    &amp;lt;bean id=&amp;quot;serviceRegistry&amp;quot; class=&amp;quot;com.xxx.rpc.registry.ServiceRegistry&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;registryAddress&amp;quot; value=&amp;quot;${registry.address}&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;

    &amp;lt;!-- é…ç½® RPC æœåŠ¡å™¨ --&amp;gt;
    &amp;lt;bean id=&amp;quot;rpcServer&amp;quot; class=&amp;quot;com.xxx.rpc.server.RpcServer&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;serverAddress&amp;quot; value=&amp;quot;${server.address}&amp;quot;/&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;serviceRegistry&amp;quot; ref=&amp;quot;serviceRegistry&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;

å…·ä½“çš„é…ç½®å‚æ•°åœ¨config.propertiesæ–‡ä»¶ä¸­ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
# ZooKeeper æœåŠ¡å™¨
registry.address=127.0.0.1:2181

# RPC æœåŠ¡å™¨
server.address=127.0.0.1:8000

ä»¥ä¸Šé…ç½®è¡¨æ˜ï¼šè¿æ¥æœ¬åœ°çš„ ZooKeeper æœåŠ¡å™¨ï¼Œå¹¶åœ¨ 8000 ç«¯å£ä¸Šå‘å¸ƒ RPC æœåŠ¡ã€‚
ä¸ºäº†åŠ è½½ Spring é…ç½®æ–‡ä»¶æ¥å‘å¸ƒæœåŠ¡ï¼Œåªéœ€ç¼–å†™ä¸€ä¸ªå¼•å¯¼ç¨‹åºå³å¯ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcBootstrap {

    public static void main(String[] args) {
        new ClassPathXmlApplicationContext(&amp;quot;spring.xml&amp;quot;);
    }
}

è¿è¡ŒRpcBootstrapç±»çš„mainæ–¹æ³•å³å¯å¯åŠ¨æœåŠ¡ç«¯ï¼Œä½†è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„ç»„ä»¶å°šæœªå®ç°ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šServiceRegistryä¸RpcServerï¼Œä¸‹æ–‡ä¼šç»™å‡ºå…·ä½“å®ç°ç»†èŠ‚ã€‚
ä½¿ç”¨ ZooKeeper å®¢æˆ·ç«¯å¯è½»æ¾å®ç°æœåŠ¡æ³¨å†ŒåŠŸèƒ½ï¼ŒServiceRegistryä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class ServiceRegistry {

    private static final Logger LOGGER = LoggerFactory.getLogger(ServiceRegistry.class);

    private CountDownLatch latch = new CountDownLatch(1);

    private String registryAddress;

    public ServiceRegistry(String registryAddress) {
        this.registryAddress = registryAddress;
    }

    public void register(String data) {
        if (data != null) {
            ZooKeeper zk = connectServer();
            if (zk != null) {
                createNode(zk, data);
            }
        }
    }

    private ZooKeeper connectServer() {
        ZooKeeper zk = null;
        try {
            zk = new ZooKeeper(registryAddress, Constant.ZK_SESSION_TIMEOUT, new Watcher() {
                @Override
                public void process(WatchedEvent event) {
                    if (event.getState() == Event.KeeperState.SyncConnected) {
                        latch.countDown();
                    }
                }
            });
            latch.await();
        } catch (IOException | InterruptedException e) {
            LOGGER.error(&amp;quot;&amp;quot;, e);
        }
        return zk;
    }

    private void createNode(ZooKeeper zk, String data) {
        try {
            byte[] bytes = data.getBytes();
            String path = zk.create(Constant.ZK_DATA_PATH, bytes, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);
            LOGGER.debug(&amp;quot;create zookeeper node ({} =&amp;gt; {})&amp;quot;, path, data);
        } catch (KeeperException | InterruptedException e) {
            LOGGER.error(&amp;quot;&amp;quot;, e);
        }
    }
}

å…¶ä¸­ï¼Œé€šè¿‡Constanté…ç½®äº†æ‰€æœ‰çš„å¸¸é‡ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public interface Constant {

    int ZK_SESSION_TIMEOUT = 5000;

    String ZK_REGISTRY_PATH = &amp;quot;/registry&amp;quot;;
    String ZK_DATA_PATH = ZK_REGISTRY_PATH + &amp;quot;/data&amp;quot;;
}

æ³¨æ„ï¼šé¦–å…ˆéœ€è¦ä½¿ç”¨ ZooKeeper å®¢æˆ·ç«¯å‘½ä»¤è¡Œåˆ›å»º/registryæ°¸ä¹…èŠ‚ç‚¹ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„æœåŠ¡ä¸´æ—¶èŠ‚ç‚¹ã€‚
ä½¿ç”¨ Netty å¯å®ç°ä¸€ä¸ªæ”¯æŒ NIO çš„ RPC æœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨ServiceRegistryæ³¨å†ŒæœåŠ¡åœ°å€ï¼ŒRpcServerä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcServer implements ApplicationContextAware, InitializingBean {

    private static final Logger LOGGER = LoggerFactory.getLogger(RpcServer.class);

    private String serverAddress;
    private ServiceRegistry serviceRegistry;

    private Map&amp;lt;String, Object&amp;gt; handlerMap = new HashMap&amp;lt;&amp;gt;(); // å­˜æ”¾æ¥å£åä¸æœåŠ¡å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»

    public RpcServer(String serverAddress) {
        this.serverAddress = serverAddress;
    }

    public RpcServer(String serverAddress, ServiceRegistry serviceRegistry) {
        this.serverAddress = serverAddress;
        this.serviceRegistry = serviceRegistry;
    }

    @Override
    public void setApplicationContext(ApplicationContext ctx) throws BeansException {
        Map&amp;lt;String, Object&amp;gt; serviceBeanMap = ctx.getBeansWithAnnotation(RpcService.class); // è·å–æ‰€æœ‰å¸¦æœ‰ RpcService æ³¨è§£çš„ Spring Bean
        if (MapUtils.isNotEmpty(serviceBeanMap)) {
            for (Object serviceBean : serviceBeanMap.values()) {
                String interfaceName = serviceBean.getClass().getAnnotation(RpcService.class).value().getName();
                handlerMap.put(interfaceName, serviceBean);
            }
        }
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        EventLoopGroup bossGroup = new NioEventLoopGroup();
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        try {
            ServerBootstrap bootstrap = new ServerBootstrap();
            bootstrap.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class)
                .childHandler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
                    @Override
                    public void initChannel(SocketChannel channel) throws Exception {
                        channel.pipeline()
                            .addLast(new RpcDecoder(RpcRequest.class)) // å°† RPC è¯·æ±‚è¿›è¡Œè§£ç ï¼ˆä¸ºäº†å¤„ç†è¯·æ±‚ï¼‰
                            .addLast(new RpcEncoder(RpcResponse.class)) // å°† RPC å“åº”è¿›è¡Œç¼–ç ï¼ˆä¸ºäº†è¿”å›å“åº”ï¼‰
                            .addLast(new RpcHandler(handlerMap)); // å¤„ç† RPC è¯·æ±‚
                    }
                })
                .option(ChannelOption.SO_BACKLOG, 128)
                .childOption(ChannelOption.SO_KEEPALIVE, true);

            String[] array = serverAddress.split(&amp;quot;:&amp;quot;);
            String host = array[0];
            int port = Integer.parseInt(array[1]);

            ChannelFuture future = bootstrap.bind(host, port).sync();
            LOGGER.debug(&amp;quot;server started on port {}&amp;quot;, port);

            if (serviceRegistry != null) {
                serviceRegistry.register(serverAddress); // æ³¨å†ŒæœåŠ¡åœ°å€
            }

            future.channel().closeFuture().sync();
        } finally {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }
}

ä»¥ä¸Šä»£ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„ POJO éœ€è¦æè¿°ä¸€ä¸‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯RpcRequestä¸RpcResponseã€‚
ä½¿ç”¨RpcRequestå°è£… RPC è¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcRequest {

    private String requestId;
    private String className;
    private String methodName;
    private Class&amp;lt;?&amp;gt;[] parameterTypes;
    private Object[] parameters;

    // getter/setter...
}

ä½¿ç”¨RpcResponseå°è£… RPC å“åº”ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcResponse {

    private String requestId;
    private Throwable error;
    private Object result;

    // getter/setter...
}

ä½¿ç”¨RpcDecoderæä¾› RPC è§£ç ï¼Œåªéœ€æ‰©å±• Netty çš„ByteToMessageDecoderæŠ½è±¡ç±»çš„decodeæ–¹æ³•å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcDecoder extends ByteToMessageDecoder {

    private Class&amp;lt;?&amp;gt; genericClass;

    public RpcDecoder(Class&amp;lt;?&amp;gt; genericClass) {
        this.genericClass = genericClass;
    }

    @Override
    public void decode(ChannelHandlerContext ctx, ByteBuf in, List&amp;lt;Object&amp;gt; out) throws Exception {
        if (in.readableBytes() &amp;lt; 4) {
            return;
        }
        in.markReaderIndex();
        int dataLength = in.readInt();
        if (dataLength &amp;lt; 0) {
            ctx.close();
        }
        if (in.readableBytes() &amp;lt; dataLength) {
            in.resetReaderIndex();
            return;
        }
        byte[] data = new byte[dataLength];
        in.readBytes(data);

        Object obj = SerializationUtil.deserialize(data, genericClass);
        out.add(obj);
    }
}

ä½¿ç”¨RpcEncoderæä¾› RPC ç¼–ç ï¼Œåªéœ€æ‰©å±• Netty çš„MessageToByteEncoderæŠ½è±¡ç±»çš„encodeæ–¹æ³•å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcEncoder extends MessageToByteEncoder {

    private Class&amp;lt;?&amp;gt; genericClass;

    public RpcEncoder(Class&amp;lt;?&amp;gt; genericClass) {
        this.genericClass = genericClass;
    }

    @Override
    public void encode(ChannelHandlerContext ctx, Object in, ByteBuf out) throws Exception {
        if (genericClass.isInstance(in)) {
            byte[] data = SerializationUtil.serialize(in);
            out.writeInt(data.length);
            out.writeBytes(data);
        }
    }
}

ç¼–å†™ä¸€ä¸ªSerializationUtilå·¥å…·ç±»ï¼Œä½¿ç”¨Protostuffå®ç°åºåˆ—åŒ–ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class SerializationUtil {

    private static Map&amp;lt;Class&amp;lt;?&amp;gt;, Schema&amp;lt;?&amp;gt;&amp;gt; cachedSchema = new ConcurrentHashMap&amp;lt;&amp;gt;();

    private static Objenesis objenesis = new ObjenesisStd(true);

    private SerializationUtil() {
    }

    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    private static &amp;lt;T&amp;gt; Schema&amp;lt;T&amp;gt; getSchema(Class&amp;lt;T&amp;gt; cls) {
        Schema&amp;lt;T&amp;gt; schema = (Schema&amp;lt;T&amp;gt;) cachedSchema.get(cls);
        if (schema == null) {
            schema = RuntimeSchema.createFrom(cls);
            if (schema != null) {
                cachedSchema.put(cls, schema);
            }
        }
        return schema;
    }

    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    public static &amp;lt;T&amp;gt; byte[] serialize(T obj) {
        Class&amp;lt;T&amp;gt; cls = (Class&amp;lt;T&amp;gt;) obj.getClass();
        LinkedBuffer buffer = LinkedBuffer.allocate(LinkedBuffer.DEFAULT_BUFFER_SIZE);
        try {
            Schema&amp;lt;T&amp;gt; schema = getSchema(cls);
            return ProtostuffIOUtil.toByteArray(obj, schema, buffer);
        } catch (Exception e) {
            throw new IllegalStateException(e.getMessage(), e);
        } finally {
            buffer.clear();
        }
    }

    public static &amp;lt;T&amp;gt; T deserialize(byte[] data, Class&amp;lt;T&amp;gt; cls) {
        try {
            T message = (T) objenesis.newInstance(cls);
            Schema&amp;lt;T&amp;gt; schema = getSchema(cls);
            ProtostuffIOUtil.mergeFrom(data, message, schema);
            return message;
        } catch (Exception e) {
            throw new IllegalStateException(e.getMessage(), e);
        }
    }
}

ä»¥ä¸Šäº†ä½¿ç”¨ Objenesis æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œå®ƒæ˜¯æ¯” Java åå°„æ›´åŠ å¼ºå¤§ã€‚
æ³¨æ„ï¼šå¦‚éœ€è¦æ›¿æ¢å…¶å®ƒåºåˆ—åŒ–æ¡†æ¶ï¼Œåªéœ€ä¿®æ”¹SerializationUtilå³å¯ã€‚å½“ç„¶ï¼Œæ›´å¥½çš„å®ç°æ–¹å¼æ˜¯æä¾›é…ç½®é¡¹æ¥å†³å®šä½¿ç”¨å“ªç§åºåˆ—åŒ–æ–¹å¼ã€‚
ä½¿ç”¨RpcHandlerä¸­å¤„ç† RPC è¯·æ±‚ï¼Œåªéœ€æ‰©å±• Netty çš„SimpleChannelInboundHandleræŠ½è±¡ç±»å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcHandler extends SimpleChannelInboundHandler&amp;lt;RpcRequest&amp;gt; {

    private static final Logger LOGGER = LoggerFactory.getLogger(RpcHandler.class);

    private final Map&amp;lt;String, Object&amp;gt; handlerMap;

    public RpcHandler(Map&amp;lt;String, Object&amp;gt; handlerMap) {
        this.handlerMap = handlerMap;
    }

    @Override
    public void channelRead0(final ChannelHandlerContext ctx, RpcRequest request) throws Exception {
        RpcResponse response = new RpcResponse();
        response.setRequestId(request.getRequestId());
        try {
            Object result = handle(request);
            response.setResult(result);
        } catch (Throwable t) {
            response.setError(t);
        }
        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
    }

    private Object handle(RpcRequest request) throws Throwable {
        String className = request.getClassName();
        Object serviceBean = handlerMap.get(className);

        Class&amp;lt;?&amp;gt; serviceClass = serviceBean.getClass();
        String methodName = request.getMethodName();
        Class&amp;lt;?&amp;gt;[] parameterTypes = request.getParameterTypes();
        Object[] parameters = request.getParameters();

        /*Method method = serviceClass.getMethod(methodName, parameterTypes);
        method.setAccessible(true);
        return method.invoke(serviceBean, parameters);*/

        FastClass serviceFastClass = FastClass.create(serviceClass);
        FastMethod serviceFastMethod = serviceFastClass.getMethod(methodName, parameterTypes);
        return serviceFastMethod.invoke(serviceBean, parameters);
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {
        LOGGER.error(&amp;quot;server caught exception&amp;quot;, cause);
        ctx.close();
    }
}

ä¸ºäº†é¿å…ä½¿ç”¨ Java åå°„å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CGLib æä¾›çš„åå°„ APIï¼Œå¦‚ä¸Šé¢ç”¨åˆ°çš„FastClassä¸FastMethodã€‚
åŒæ ·ä½¿ç”¨ Spring é…ç½®æ–‡ä»¶æ¥é…ç½® RPC å®¢æˆ·ç«¯ï¼Œspring.xmlä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
&amp;lt;beans ...&amp;gt;
    &amp;lt;context:property-placeholder location=&amp;quot;classpath:config.properties&amp;quot;/&amp;gt;

    &amp;lt;!-- é…ç½®æœåŠ¡å‘ç°ç»„ä»¶ --&amp;gt;
    &amp;lt;bean id=&amp;quot;serviceDiscovery&amp;quot; class=&amp;quot;com.xxx.rpc.registry.ServiceDiscovery&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;registryAddress&amp;quot; value=&amp;quot;${registry.address}&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;

    &amp;lt;!-- é…ç½® RPC ä»£ç† --&amp;gt;
    &amp;lt;bean id=&amp;quot;rpcProxy&amp;quot; class=&amp;quot;com.xxx.rpc.client.RpcProxy&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;serviceDiscovery&amp;quot; ref=&amp;quot;serviceDiscovery&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;

å…¶ä¸­config.propertiesæä¾›äº†å…·ä½“çš„é…ç½®ï¼š
&amp;lt;!-- lang: java --&amp;gt;
# ZooKeeper æœåŠ¡å™¨
registry.address=127.0.0.1:2181

åŒæ ·ä½¿ç”¨ ZooKeeper å®ç°æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œè§å¦‚ä¸‹ä»£ç ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class ServiceDiscovery {

    private static final Logger LOGGER = LoggerFactory.getLogger(ServiceDiscovery.class);

    private CountDownLatch latch = new CountDownLatch(1);

    private volatile List&amp;lt;String&amp;gt; dataList = new ArrayList&amp;lt;&amp;gt;();

    private String registryAddress;

    public ServiceDiscovery(String registryAddress) {
        this.registryAddress = registryAddress;

        ZooKeeper zk = connectServer();
        if (zk != null) {
            watchNode(zk);
        }
    }

    public String discover() {
        String data = null;
        int size = dataList.size();
        if (size &amp;gt; 0) {
            if (size == 1) {
                data = dataList.get(0);
                LOGGER.debug(&amp;quot;using only data: {}&amp;quot;, data);
            } else {
                data = dataList.get(ThreadLocalRandom.current().nextInt(size));
                LOGGER.debug(&amp;quot;using random data: {}&amp;quot;, data);
            }
        }
        return data;
    }

    private ZooKeeper connectServer() {
        ZooKeeper zk = null;
        try {
            zk = new ZooKeeper(registryAddress, Constant.ZK_SESSION_TIMEOUT, new Watcher() {
                @Override
                public void process(WatchedEvent event) {
                    if (event.getState() == Event.KeeperState.SyncConnected) {
                        latch.countDown();
                    }
                }
            });
            latch.await();
        } catch (IOException | InterruptedException e) {
            LOGGER.error(&amp;quot;&amp;quot;, e);
        }
        return zk;
    }

    private void watchNode(final ZooKeeper zk) {
        try {
            List&amp;lt;String&amp;gt; nodeList = zk.getChildren(Constant.ZK_REGISTRY_PATH, new Watcher() {
                @Override
                public void process(WatchedEvent event) {
                    if (event.getType() == Event.EventType.NodeChildrenChanged) {
                        watchNode(zk);
                    }
                }
            });
            List&amp;lt;String&amp;gt; dataList = new ArrayList&amp;lt;&amp;gt;();
            for (String node : nodeList) {
                byte[] bytes = zk.getData(Constant.ZK_REGISTRY_PATH + &amp;quot;/&amp;quot; + node, false, null);
                dataList.add(new String(bytes));
            }
            LOGGER.debug(&amp;quot;node data: {}&amp;quot;, dataList);
            this.dataList = dataList;
        } catch (KeeperException | InterruptedException e) {
            LOGGER.error(&amp;quot;&amp;quot;, e);
        }
    }
}

è¿™é‡Œä½¿ç”¨ Java æä¾›çš„åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç° RPC ä»£ç†ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ CGLib æ¥å®ç°ï¼‰ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcProxy {

    private String serverAddress;
    private ServiceDiscovery serviceDiscovery;

    public RpcProxy(String serverAddress) {
        this.serverAddress = serverAddress;
    }

    public RpcProxy(ServiceDiscovery serviceDiscovery) {
        this.serviceDiscovery = serviceDiscovery;
    }

    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    public &amp;lt;T&amp;gt; T create(Class&amp;lt;?&amp;gt; interfaceClass) {
        return (T) Proxy.newProxyInstance(
            interfaceClass.getClassLoader(),
            new Class&amp;lt;?&amp;gt;[]{interfaceClass},
            new InvocationHandler() {
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    RpcRequest request = new RpcRequest(); // åˆ›å»ºå¹¶åˆå§‹åŒ– RPC è¯·æ±‚
                    request.setRequestId(UUID.randomUUID().toString());
                    request.setClassName(method.getDeclaringClass().getName());
                    request.setMethodName(method.getName());
                    request.setParameterTypes(method.getParameterTypes());
                    request.setParameters(args);

                    if (serviceDiscovery != null) {
                        serverAddress = serviceDiscovery.discover(); // å‘ç°æœåŠ¡
                    }

                    String[] array = serverAddress.split(&amp;quot;:&amp;quot;);
                    String host = array[0];
                    int port = Integer.parseInt(array[1]);

                    RpcClient client = new RpcClient(host, port); // åˆå§‹åŒ– RPC å®¢æˆ·ç«¯
                    RpcResponse response = client.send(request); // é€šè¿‡ RPC å®¢æˆ·ç«¯å‘é€ RPC è¯·æ±‚å¹¶è·å– RPC å“åº”

                    if (response.isError()) {
                        throw response.getError();
                    } else {
                        return response.getResult();
                    }
                }
            }
        );
    }
}

ä½¿ç”¨RpcClientç±»å®ç° RPC å®¢æˆ·ç«¯ï¼Œåªéœ€æ‰©å±• Netty æä¾›çš„SimpleChannelInboundHandleræŠ½è±¡ç±»å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
public class RpcClient extends SimpleChannelInboundHandler&amp;lt;RpcResponse&amp;gt; {

    private static final Logger LOGGER = LoggerFactory.getLogger(RpcClient.class);

    private String host;
    private int port;

    private RpcResponse response;

    private final Object obj = new Object();

    public RpcClient(String host, int port) {
        this.host = host;
        this.port = port;
    }

    @Override
    public void channelRead0(ChannelHandlerContext ctx, RpcResponse response) throws Exception {
        this.response = response;

        synchronized (obj) {
            obj.notifyAll(); // æ”¶åˆ°å“åº”ï¼Œå”¤é†’çº¿ç¨‹
        }
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {
        LOGGER.error(&amp;quot;client caught exception&amp;quot;, cause);
        ctx.close();
    }

    public RpcResponse send(RpcRequest request) throws Exception {
        EventLoopGroup group = new NioEventLoopGroup();
        try {
            Bootstrap bootstrap = new Bootstrap();
            bootstrap.group(group).channel(NioSocketChannel.class)
                .handler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
                    @Override
                    public void initChannel(SocketChannel channel) throws Exception {
                        channel.pipeline()
                            .addLast(new RpcEncoder(RpcRequest.class)) // å°† RPC è¯·æ±‚è¿›è¡Œç¼–ç ï¼ˆä¸ºäº†å‘é€è¯·æ±‚ï¼‰
                            .addLast(new RpcDecoder(RpcResponse.class)) // å°† RPC å“åº”è¿›è¡Œè§£ç ï¼ˆä¸ºäº†å¤„ç†å“åº”ï¼‰
                            .addLast(RpcClient.this); // ä½¿ç”¨ RpcClient å‘é€ RPC è¯·æ±‚
                    }
                })
                .option(ChannelOption.SO_KEEPALIVE, true);

            ChannelFuture future = bootstrap.connect(host, port).sync();
            future.channel().writeAndFlush(request).sync();

            synchronized (obj) {
                obj.wait(); // æœªæ”¶åˆ°å“åº”ï¼Œä½¿çº¿ç¨‹ç­‰å¾…
            }

            if (response != null) {
                future.channel().closeFuture().sync();
            }
            return response;
        } finally {
            group.shutdownGracefully();
        }
    }
}

ä½¿ç”¨ JUnit ç»“åˆ Spring ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œä»£ç å¦‚ä¸‹ï¼š
&amp;lt;!-- lang: java --&amp;gt;
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &amp;quot;classpath:spring.xml&amp;quot;)
public class HelloServiceTest {

    @Autowired
    private RpcProxy rpcProxy;

    @Test
    public void helloTest() {
        HelloService helloService = rpcProxy.create(HelloService.class);
        String result = helloService.hello(&amp;quot;World&amp;quot;);
        Assert.assertEquals(&amp;quot;Hello! World&amp;quot;, result);
    }
}

è¿è¡Œä»¥ä¸Šå•å…ƒæµ‹è¯•ï¼Œå¦‚æœä¸å‡ºæ„å¤–çš„è¯ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç»¿æ¡ã€‚
æœ¬æ–‡é€šè¿‡ Spring + Netty + Protostuff + ZooKeeper å®ç°äº†ä¸€ä¸ªè½»é‡çº§ RPC æ¡†æ¶ï¼Œä½¿ç”¨ Spring æä¾›ä¾èµ–æ³¨å…¥ä¸å‚æ•°é…ç½®ï¼Œä½¿ç”¨ Netty å®ç° NIO æ–¹å¼çš„æ•°æ®ä¼ è¾“ï¼Œä½¿ç”¨ Protostuff å®ç°å¯¹è±¡åºåˆ—åŒ–ï¼Œä½¿ç”¨ ZooKeeper å®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚ä½¿ç”¨è¯¥æ¡†æ¶ï¼Œå¯å°†æœåŠ¡éƒ¨ç½²åˆ°åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸Šï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿œç¨‹æ¥å£æ¥è°ƒç”¨æœåŠ¡ç«¯çš„å…·ä½“å®ç°ï¼Œè®©æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„å¼€å‘å®Œå…¨åˆ†ç¦»ï¼Œä¸ºå®ç°å¤§è§„æ¨¡åˆ†å¸ƒå¼åº”ç”¨æä¾›äº†åŸºç¡€æ”¯æŒã€‚
&amp;lt;!-- lang: xml --&amp;gt;
&amp;lt;!-- JUnit --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.11&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- SLF4J --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.7.7&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Spring --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-context&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.2.12.RELEASE&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-test&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.2.12.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Netty --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;io.netty&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;netty-all&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.0.24.Final&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Protostuff --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.dyuproject.protostuff&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;protostuff-core&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.0.8&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.dyuproject.protostuff&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;protostuff-runtime&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.0.8&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- ZooKeeper --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.zookeeper&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;zookeeper&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.4.6&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Apache Commons Collections --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;commons-collections4&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Objenesis --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.objenesis&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;objenesis&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- CGLib --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;cglib&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;cglib&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;


æºç åœ°å€ï¼šhttp://git.oschina.net/huangyong/rpc


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zhch602.github.io/post/qing-liang-ji-fen-bu-shi-rpc-kuang-jia">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zhch602.github.io/post/zai-gao-bing-fa-de-he-xin-ji-zhu-zhong-ru-he-shi-xian-mi-deng-xing">
                        åœ¨é«˜å¹¶å‘çš„æ ¸å¿ƒæŠ€æœ¯ä¸­å¦‚ä½•å®ç°å¹‚ç­‰æ€§
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2019-05-06</time>
                    
                        <a href="https://zhch602.github.io/tag/imQ_OK1Mz" class="post-tag i-tag
                            i-tag-other_2">
            #java
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            å®é™…ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šæ“ä½œï¼Œæ˜¯ä¸ç®¡åšå¤šå°‘æ¬¡ï¼Œéƒ½åº”è¯¥äº§ç”Ÿä¸€æ ·çš„æ•ˆæœæˆ–è¿”å›ä¸€æ ·çš„ç»“æœã€‚
ä¾‹å¦‚ï¼š
1. å‰ç«¯é‡å¤æäº¤é€‰ä¸­çš„æ•°æ®ï¼Œåº”è¯¥åå°åªäº§ç”Ÿå¯¹åº”è¿™ä¸ªæ•°æ®çš„ä¸€ä¸ªååº”ç»“æœã€‚
2. æˆ‘ä»¬å‘èµ·ä¸€ç¬”ä»˜æ¬¾è¯·æ±‚ï¼Œåº”è¯¥åªæ‰£ç”¨æˆ·è´¦æˆ·ä¸€æ¬¡é’±ï¼Œå½“é‡åˆ°ç½‘ç»œé‡å‘æˆ–ç³»ç»Ÿbugé‡å‘ï¼Œä¹Ÿåº”è¯¥åªæ‰£ä¸€æ¬¡é’±ï¼›
3. å‘é€æ¶ˆæ¯ï¼Œä¹Ÿåº”è¯¥åªå‘ä¸€æ¬¡ï¼ŒåŒæ ·çš„çŸ­ä¿¡å‘ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä¼šå´©æºƒï¼›
4. åˆ›å»ºä¸šåŠ¡è®¢å•ï¼Œä¸€æ¬¡ä¸šåŠ¡è¯·æ±‚åªèƒ½åˆ›å»ºä¸€ä¸ªï¼Œåˆ›å»ºå¤šä¸ªå°±ä¼šå‡ºå¤§é—®é¢˜ã€‚
ç­‰ç­‰å¾ˆå¤šé‡è¦çš„æƒ…å†µï¼Œè¿™äº›é€»è¾‘éƒ½éœ€è¦å¹‚ç­‰çš„ç‰¹æ€§æ¥æ”¯æŒã€‚
ä¸‹é¢è¯´è¯´å¹‚ç­‰æ€§æ¦‚å¿µï¼š
å¹‚ç­‰ï¼ˆidempotentã€idempotenceï¼‰æ˜¯ä¸€ä¸ªæ•°å­¦ä¸è®¡ç®—æœºå­¦æ¦‚å¿µï¼Œå¸¸è§äºæŠ½è±¡ä»£æ•°ä¸­ã€‚
åœ¨ç¼–ç¨‹ä¸­ï¼Œä¸€ä¸ªå¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯å…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚å¹‚ç­‰å‡½æ•°ï¼Œæˆ–å¹‚ç­‰æ–¹æ³•ï¼Œæ˜¯æŒ‡å¯ä»¥ä½¿ç”¨ç›¸åŒå‚æ•°é‡å¤æ‰§è¡Œï¼Œå¹¶èƒ½è·å¾—ç›¸åŒç»“æœçš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°ä¸ä¼šå½±å“ç³»ç»ŸçŠ¶æ€ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œä¼šå¯¹ç³»ç»Ÿé€ æˆæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œâ€œgetUsername()å’ŒsetTrue()â€å‡½æ•°å°±æ˜¯ä¸€ä¸ªå¹‚ç­‰å‡½æ•°ã€‚
æ›´å¤æ‚çš„æ“ä½œå¹‚ç­‰ä¿è¯æ˜¯åˆ©ç”¨å”¯ä¸€äº¤æ˜“å·(æµæ°´å·)å®ç°.
ç”¨é€šä¿—çš„è¯è®²ï¼Œå¹‚ç­‰å°±æ˜¯ä¸€ä¸ªæ“ä½œï¼Œä¸è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œäº§ç”Ÿçš„æ•ˆæœå’Œè¿”å›çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚
å®ç°å¹‚ç­‰æ€§çš„æŠ€æœ¯æ–¹æ¡ˆ
1. æŸ¥è¯¢æ“ä½œ
æŸ¥è¯¢ä¸€æ¬¡å’ŒæŸ¥è¯¢å¤šæ¬¡ï¼Œåœ¨æ•°æ®ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œselectæ˜¯å¤©ç„¶çš„å¹‚ç­‰æ“ä½œã€‚
2. åˆ é™¤æ“ä½œ
åˆ é™¤æ“ä½œä¹Ÿæ˜¯å¹‚ç­‰çš„ï¼Œåˆ é™¤ä¸€æ¬¡å’Œå¤šæ¬¡åˆ é™¤éƒ½æ˜¯æŠŠæ•°æ®åˆ é™¤ã€‚(æ³¨æ„å¯èƒ½è¿”å›ç»“æœä¸ä¸€æ ·ï¼Œåˆ é™¤çš„æ•°æ®ä¸å­˜åœ¨ï¼Œè¿”å›0ï¼Œåˆ é™¤çš„æ•°æ®å¤šæ¡ï¼Œè¿”å›ç»“æœå¤šä¸ª)ã€‚
3.å”¯ä¸€ç´¢å¼•ï¼Œé˜²æ­¢æ–°å¢è„æ•°æ®
æ¯”å¦‚ï¼šæ”¯ä»˜å®çš„èµ„é‡‘è´¦æˆ·ï¼Œæ”¯ä»˜å®ä¹Ÿæœ‰ç”¨æˆ·è´¦æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªèµ„é‡‘è´¦æˆ·ï¼Œæ€ä¹ˆé˜²æ­¢ç»™ç”¨æˆ·åˆ›å»ºèµ„é‡‘è´¦æˆ·å¤šä¸ªï¼Œé‚£ä¹ˆç»™èµ„é‡‘è´¦æˆ·è¡¨ä¸­çš„ç”¨æˆ·IDåŠ å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥ä¸€ä¸ªç”¨æˆ·æ–°å¢æˆåŠŸä¸€ä¸ªèµ„é‡‘è´¦æˆ·è®°å½•ã€‚
è¦ç‚¹ï¼šå”¯ä¸€ç´¢å¼•æˆ–å”¯ä¸€ç»„åˆç´¢å¼•æ¥é˜²æ­¢æ–°å¢æ•°æ®å­˜åœ¨è„æ•°æ® ï¼ˆå½“è¡¨å­˜åœ¨å”¯ä¸€ç´¢å¼•ï¼Œå¹¶å‘æ—¶æ–°å¢æŠ¥é”™æ—¶ï¼Œå†æŸ¥è¯¢ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œæ•°æ®åº”è¯¥å·²ç»å­˜åœ¨äº†ï¼Œè¿”å›ç»“æœå³å¯ï¼‰ã€‚
4. tokenæœºåˆ¶ï¼Œé˜²æ­¢é¡µé¢é‡å¤æäº¤
ä¸šåŠ¡è¦æ±‚ï¼šé¡µé¢çš„æ•°æ®åªèƒ½è¢«ç‚¹å‡»æäº¤ä¸€æ¬¡ï¼›
å‘ç”ŸåŸå› ï¼šç”±äºé‡å¤ç‚¹å‡»æˆ–è€…ç½‘ç»œé‡å‘ï¼Œæˆ–è€…nginxé‡å‘ç­‰æƒ…å†µä¼šå¯¼è‡´æ•°æ®è¢«é‡å¤æäº¤ã€‚
è§£å†³åŠæ³•ï¼š
é›†ç¾¤ç¯å¢ƒï¼šé‡‡ç”¨tokenåŠ redisï¼ˆrediså•çº¿ç¨‹çš„ï¼Œå¤„ç†éœ€è¦æ’é˜Ÿï¼‰
å•JVMç¯å¢ƒï¼šé‡‡ç”¨tokenåŠ redisæˆ–tokenåŠ jvmå†…å­˜
å¤„ç†æµç¨‹ï¼š
1. æ•°æ®æäº¤å‰è¦å‘æœåŠ¡çš„ç”³è¯·tokenï¼Œtokenæ”¾åˆ°redisæˆ–jvmå†…å­˜ï¼Œtokenæœ‰æ•ˆæ—¶é—´
2. æäº¤ååå°æ ¡éªŒtokenï¼ŒåŒæ—¶åˆ é™¤tokenï¼Œç”Ÿæˆæ–°çš„tokenè¿”å›
tokenç‰¹ç‚¹ï¼š è¦ç”³è¯·ï¼Œä¸€æ¬¡æœ‰æ•ˆæ€§ï¼Œå¯ä»¥é™æµ
æ³¨æ„ï¼šredisè¦ç”¨åˆ é™¤æ“ä½œæ¥åˆ¤æ–­tokenï¼Œåˆ é™¤æˆåŠŸä»£è¡¨tokenæ ¡éªŒé€šè¿‡ï¼Œå¦‚æœç”¨select+deleteæ¥æ ¡éªŒtokenï¼Œå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä¸å»ºè®®ä½¿ç”¨
5. æ‚²è§‚é”
è·å–æ•°æ®çš„æ—¶å€™åŠ é”è·å–
select * from table_xxx where id=&#39;xxx&#39; for update;
æ³¨æ„ï¼šidå­—æ®µä¸€å®šæ˜¯ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä¸ç„¶æ˜¯é”è¡¨ï¼Œä¼šå‡ºäº‹çš„ã€‚
æ‚²è§‚é”ä½¿ç”¨æ—¶ä¸€èˆ¬ä¼´éšäº‹åŠ¡ä¸€èµ·ä½¿ç”¨ï¼Œæ•°æ®é”å®šæ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰ç”¨

6. ä¹è§‚é”
ä¹è§‚é”åªæ˜¯åœ¨æ›´æ–°æ•°æ®é‚£ä¸€åˆ»é”è¡¨ï¼Œå…¶ä»–æ—¶é—´ä¸é”è¡¨ï¼Œæ‰€ä»¥ç›¸å¯¹äºæ‚²è§‚é”ï¼Œæ•ˆç‡æ›´é«˜ã€‚
ä¹è§‚é”çš„å®ç°æ–¹å¼å¤šç§å¤šæ ·å¯ä»¥é€šè¿‡versionæˆ–è€…å…¶ä»–çŠ¶æ€æ¡ä»¶ï¼š
1. é€šè¿‡ç‰ˆæœ¬å·å®ç°
update table_xxx set name=#name#,version=version+1 where version=#version#
2. é€šè¿‡æ¡ä»¶é™åˆ¶
update table_xxx set avai_amount=avai_amount-#subAmount# where avai_amount-#subAmount# &amp;gt;= 0
è¦æ±‚ï¼šquality-#subQuality# &amp;gt;= ï¼Œè¿™ä¸ªæƒ…æ™¯é€‚åˆä¸ç”¨ç‰ˆæœ¬å·ï¼Œåªæ›´æ–°æ˜¯åšæ•°æ®å®‰å…¨æ ¡éªŒï¼Œé€‚åˆåº“å­˜æ¨¡å‹ï¼Œæ‰£ä»½é¢å’Œå›æ»šä»½é¢ï¼Œæ€§èƒ½æ›´é«˜ã€‚
æ³¨æ„ï¼šä¹è§‚é”çš„æ›´æ–°æ“ä½œï¼Œæœ€å¥½ç”¨ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•æ¥æ›´æ–°,è¿™æ ·æ˜¯è¡Œé”ï¼Œå¦åˆ™æ›´æ–°æ—¶ä¼šé”è¡¨ï¼Œä¸Šé¢ä¸¤ä¸ªsqlæ”¹æˆä¸‹é¢çš„ä¸¤ä¸ªæ›´å¥½ã€‚
update table_xxx set name=#name#,version=version+1 where id=#id# and version=#version#
update table_xxx set avai_amount=avai_amount-#subAmount# where id=#id# and avai_amount-#subAmount# &amp;gt;= 0
7. åˆ†å¸ƒå¼é”
è¿˜æ˜¯æ‹¿æ’å…¥æ•°æ®çš„ä¾‹å­ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒæ˜¯ç³»ç»Ÿï¼Œæ„å»ºå…¨å±€å”¯ä¸€ç´¢å¼•æ¯”è¾ƒå›°éš¾ï¼Œä¾‹å¦‚å”¯ä¸€æ€§çš„å­—æ®µæ²¡æ³•ç¡®å®šï¼Œè¿™æ—¶å€™å¯ä»¥å¼•å…¥åˆ†å¸ƒå¼é”ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹çš„ç³»ç»Ÿ(redisæˆ–zookeeper)ï¼Œåœ¨ä¸šåŠ¡ç³»ç»Ÿæ’å…¥æ•°æ®æˆ–è€…æ›´æ–°æ•°æ®ï¼Œè·å–åˆ†å¸ƒå¼é”ï¼Œç„¶ååšæ“ä½œï¼Œä¹‹åé‡Šæ”¾é”ï¼Œè¿™æ ·å…¶å®æ˜¯æŠŠå¤šçº¿ç¨‹å¹¶å‘çš„é”çš„æ€è·¯ï¼Œå¼•å…¥å¤šå¤šä¸ªç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¾—è§£å†³æ€è·¯ã€‚
è¦ç‚¹ï¼šæŸä¸ªé•¿æµç¨‹å¤„ç†è¿‡ç¨‹è¦æ±‚ä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥åœ¨æµç¨‹æ‰§è¡Œä¹‹å‰æ ¹æ®æŸä¸ªæ ‡å¿—(ç”¨æˆ·ID+åç¼€ç­‰)è·å–åˆ†å¸ƒå¼é”ï¼Œå…¶ä»–æµç¨‹æ‰§è¡Œæ—¶è·å–é”å°±ä¼šå¤±è´¥ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´è¯¥æµç¨‹åªèƒ½æœ‰ä¸€ä¸ªèƒ½æ‰§è¡ŒæˆåŠŸï¼Œæ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾åˆ†å¸ƒå¼é”(åˆ†å¸ƒå¼é”è¦ç¬¬ä¸‰æ–¹ç³»ç»Ÿæä¾›)ã€‚
8. select + insert
å¹¶å‘ä¸é«˜çš„åå°ç³»ç»Ÿï¼Œæˆ–è€…ä¸€äº›ä»»åŠ¡JOBï¼Œä¸ºäº†æ”¯æŒå¹‚ç­‰ï¼Œæ”¯æŒé‡å¤æ‰§è¡Œï¼Œç®€å•çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œå…ˆæŸ¥è¯¢ä¸‹ä¸€äº›å…³é”®æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡ï¼Œåœ¨è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå°±å¯ä»¥äº†ã€‚
æ³¨æ„ï¼šæ ¸å¿ƒé«˜å¹¶å‘æµç¨‹ä¸è¦ç”¨è¿™ç§æ–¹æ³•ã€‚
9. çŠ¶æ€æœºå¹‚ç­‰
åœ¨è®¾è®¡å•æ®ç›¸å…³çš„ä¸šåŠ¡ï¼Œæˆ–è€…æ˜¯ä»»åŠ¡ç›¸å…³çš„ä¸šåŠ¡ï¼Œè‚¯å®šä¼šæ¶‰åŠåˆ°çŠ¶æ€æœº(çŠ¶æ€å˜æ›´å›¾)ï¼Œå°±æ˜¯ä¸šåŠ¡å•æ®ä¸Šé¢æœ‰ä¸ªçŠ¶æ€ï¼ŒçŠ¶æ€åœ¨ä¸åŒçš„æƒ…å†µä¸‹ä¼šå‘ç”Ÿå˜æ›´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å­˜åœ¨æœ‰é™çŠ¶æ€æœºï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœçŠ¶æ€æœºå·²ç»å¤„äºä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™æ—¶å€™æ¥äº†ä¸€ä¸ªä¸Šä¸€ä¸ªçŠ¶æ€çš„å˜æ›´ï¼Œç†è®ºä¸Šæ˜¯ä¸èƒ½å¤Ÿå˜æ›´çš„ï¼Œè¿™æ ·çš„è¯ï¼Œä¿è¯äº†æœ‰é™çŠ¶æ€æœºçš„å¹‚ç­‰ã€‚
æ³¨æ„ï¼šè®¢å•ç­‰å•æ®ç±»ä¸šåŠ¡ï¼Œå­˜åœ¨å¾ˆé•¿çš„çŠ¶æ€æµè½¬ï¼Œä¸€å®šè¦æ·±åˆ»ç†è§£çŠ¶æ€æœºï¼Œå¯¹ä¸šåŠ¡ç³»ç»Ÿè®¾è®¡èƒ½åŠ›æé«˜æœ‰å¾ˆå¤§å¸®åŠ©ã€‚
10. å¯¹å¤–æä¾›æ¥å£çš„apiå¦‚ä½•ä¿è¯å¹‚ç­‰
å¦‚é“¶è”æä¾›çš„ä»˜æ¬¾æ¥å£ï¼šéœ€è¦æ¥å…¥å•†æˆ·æäº¤ä»˜æ¬¾è¯·æ±‚æ—¶é™„å¸¦ï¼šsourceæ¥æºï¼Œseqåºåˆ—å·
source+seqåœ¨æ•°æ®åº“é‡Œé¢åšå”¯ä¸€ç´¢å¼•ï¼Œé˜²æ­¢å¤šæ¬¡ä»˜æ¬¾ï¼Œ(å¹¶å‘æ—¶ï¼Œåªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚)ã€‚
é‡ç‚¹ï¼š
å¯¹å¤–æä¾›æ¥å£ä¸ºäº†æ”¯æŒå¹‚ç­‰è°ƒç”¨ï¼Œæ¥å£æœ‰ä¸¤ä¸ªå­—æ®µå¿…é¡»ä¼ ï¼Œä¸€ä¸ªæ˜¯æ¥æºsourceï¼Œä¸€ä¸ªæ˜¯æ¥æºæ–¹åºåˆ—å·seqï¼Œè¿™ä¸ªä¸¤ä¸ªå­—æ®µåœ¨æä¾›æ–¹ç³»ç»Ÿé‡Œé¢åšè”åˆå”¯ä¸€ç´¢å¼•ï¼Œè¿™æ ·å½“ç¬¬ä¸‰æ–¹è°ƒç”¨æ—¶ï¼Œå…ˆåœ¨æœ¬æ–¹ç³»ç»Ÿé‡Œé¢æŸ¥è¯¢ä¸€ä¸‹ï¼Œæ˜¯å¦å·²ç»å¤„ç†è¿‡ï¼Œè¿”å›ç›¸åº”å¤„ç†ç»“æœï¼›æ²¡æœ‰å¤„ç†è¿‡ï¼Œè¿›è¡Œç›¸åº”å¤„ç†ï¼Œè¿”å›ç»“æœã€‚æ³¨æ„ï¼Œä¸ºäº†å¹‚ç­‰å‹å¥½ï¼Œä¸€å®šè¦å…ˆæŸ¥è¯¢ä¸€ä¸‹ï¼Œæ˜¯å¦å¤„ç†è¿‡è¯¥ç¬”ä¸šåŠ¡ï¼Œä¸æŸ¥è¯¢ç›´æ¥æ’å…¥ä¸šåŠ¡ç³»ç»Ÿï¼Œä¼šæŠ¥é”™ï¼Œä½†å®é™…å·²ç»å¤„ç†äº†ã€‚
æœ€åæ€»ç»“ï¼š
å¹‚ç­‰æ€§åº”è¯¥æ˜¯åˆæ ¼ç¨‹åºå‘˜çš„ä¸€ä¸ªåŸºå› ï¼Œåœ¨è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæ˜¯é¦–è¦è€ƒè™‘çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨åƒç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼Œé“¶è¡Œï¼Œäº’è”ç½‘é‡‘èå…¬å¸ç­‰æ¶‰åŠçš„ç½‘ä¸Šèµ„é‡‘ç³»ç»Ÿï¼Œæ—¢è¦é«˜æ•ˆï¼Œæ•°æ®ä¹Ÿè¦å‡†ç¡®ï¼Œæ‰€ä»¥ä¸èƒ½å‡ºç°å¤šæ‰£æ¬¾ï¼Œå¤šæ‰“æ¬¾ç­‰é—®é¢˜ï¼Œè¿™æ ·ä¼šå¾ˆéš¾å¤„ç†ï¼Œå¹¶ä¼šå¤§å¤§é™ä½ç”¨æˆ·ä½“éªŒã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zhch602.github.io/post/zai-gao-bing-fa-de-he-xin-ji-zhu-zhong-ru-he-shi-xian-mi-deng-xing">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zhch602.github.io/post/uuid">
                        UUID
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-05-06</time>
                    
                        <a href="https://zhch602.github.io/tag/imQ_OK1Mz" class="post-tag i-tag
                            i-tag-other_2">
            #java
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            é¦–å…ˆï¼Œå³ä¾¿æ˜¯è™šæ‹Ÿæœºçš„è¯MACåœ°å€ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦å¤–ä½ è¯´çš„ç»Ÿä¸€æ—¶é—´è¿˜æ˜¯ä¸ªå®è§‚çš„æ¦‚å¿µï¼Œè¿™ä¸ªä»…ä»…æ˜¯å†³å®šäº†UUIDç”Ÿäº§ä¸²ä¸­çš„æŸä¸€éƒ¨åˆ†ç›¸åŒè€Œå·²ï¼Œå› ä¸ºä¸ºäº†ä¿è¯UUIDçš„å”¯ä¸€æ€§ï¼Œè§„èŒƒå®šä¹‰äº†åŒ…æ‹¬ç½‘å¡MACåœ°å€ã€æ—¶é—´æˆ³ã€åå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€éšæœºæˆ–ä¼ªéšæœºæ•°ã€æ—¶åºç­‰å…ƒç´ ã€‚
å½“ç„¶ï¼Œä½ è¦è¯´UUIDæ˜¯ä¸æ˜¯ç»å¯¹çš„ä¸ä¼šå‡ºç°é‡å¤çš„ï¼Œè¿™ä¸ªä¹Ÿä¸èƒ½è¿™æ ·è¯´çš„ï¼ˆæˆ‘ä¸‹é¢ä¼šæåˆ°ï¼‰ã€‚
UUIDå…·æœ‰ä»¥ä¸‹æ¶µä¹‰ï¼š
ç»ç”±ä¸€å®šçš„ç®—æ³•æœºå™¨ç”Ÿæˆ
ä¸ºäº†ä¿è¯UUIDçš„å”¯ä¸€æ€§ï¼Œè§„èŒƒå®šä¹‰äº†åŒ…æ‹¬ç½‘å¡MACåœ°å€ã€æ—¶é—´æˆ³ã€åå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€éšæœºæˆ–ä¼ªéšæœºæ•°ã€æ—¶åºç­‰å…ƒç´ ï¼Œä»¥åŠä»è¿™äº›å…ƒç´ ç”ŸæˆUUIDçš„ç®—æ³•ã€‚UUIDçš„å¤æ‚ç‰¹æ€§åœ¨ä¿è¯äº†å…¶å”¯ä¸€æ€§çš„åŒæ—¶ï¼Œæ„å‘³ç€åªèƒ½ç”±è®¡ç®—æœºç”Ÿæˆã€‚
éäººå·¥æŒ‡å®šï¼Œéäººå·¥è¯†åˆ«
UUIDæ˜¯ä¸èƒ½äººå·¥æŒ‡å®šçš„ï¼Œé™¤éä½ å†’ç€UUIDé‡å¤çš„é£é™©ã€‚UUIDçš„å¤æ‚æ€§å†³å®šäº†â€œä¸€èˆ¬äººâ€œä¸èƒ½ç›´æ¥ä»ä¸€ä¸ªUUIDçŸ¥é“å“ªä¸ªå¯¹è±¡å’Œå®ƒå…³è”ã€‚
åœ¨ç‰¹å®šçš„èŒƒå›´å†…é‡å¤çš„å¯èƒ½æ€§æå°
UUIDçš„ç”Ÿæˆè§„èŒƒå®šä¹‰çš„ç®—æ³•ä¸»è¦ç›®çš„å°±æ˜¯è¦ä¿è¯å…¶å”¯ä¸€æ€§ã€‚ä½†è¿™ä¸ªå”¯ä¸€æ€§æ˜¯æœ‰é™çš„ï¼Œåªåœ¨ç‰¹å®šçš„èŒƒå›´å†…æ‰èƒ½å¾—åˆ°ä¿è¯ï¼Œè¿™å’ŒUUIDçš„ç±»å‹æœ‰å…³ï¼ˆå‚è§UUIDçš„ç‰ˆæœ¬ï¼‰ã€‚
UUIDçš„ç‰ˆæœ¬UUIDå…·æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„ç®—æ³•ä¸åŒï¼Œåº”ç”¨èŒƒå›´ä¹Ÿä¸åŒã€‚
é¦–å…ˆæ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼ï¼Nil UUIDï¼ï¼é€šå¸¸æˆ‘ä»¬ä¸ä¼šç”¨åˆ°å®ƒï¼Œå®ƒæ˜¯ç”±å…¨ä¸º0çš„æ•°å­—ç»„æˆï¼Œå¦‚ä¸‹ï¼š
00000000-0000-0000-0000-000000000000
UUID Version 1ï¼šåŸºäºæ—¶é—´çš„UUID
åŸºäºæ—¶é—´çš„UUIDé€šè¿‡è®¡ç®—å½“å‰æ—¶é—´æˆ³ã€éšæœºæ•°å’Œæœºå™¨MACåœ°å€å¾—åˆ°ã€‚ç”±äºåœ¨ç®—æ³•ä¸­ä½¿ç”¨äº†MACåœ°å€ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„UUIDå¯ä»¥ä¿è¯åœ¨å…¨çƒèŒƒå›´çš„å”¯ä¸€æ€§ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œä½¿ç”¨MACåœ°å€ä¼šå¸¦æ¥å®‰å…¨æ€§é—®é¢˜ï¼Œè¿™å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬UUIDå—åˆ°æ‰¹è¯„çš„åœ°æ–¹ã€‚å¦‚æœåº”ç”¨åªæ˜¯åœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€€åŒ–çš„ç®—æ³•ï¼Œä»¥IPåœ°å€æ¥ä»£æ›¿MACåœ°å€ï¼ï¼Javaçš„UUIDå¾€å¾€æ˜¯è¿™æ ·å®ç°çš„ï¼ˆå½“ç„¶ä¹Ÿè€ƒè™‘äº†è·å–MACçš„éš¾åº¦ï¼‰ã€‚
UUID Version 2ï¼šDCEå®‰å…¨çš„UUID
DCEï¼ˆDistributed Computing Environmentï¼‰å®‰å…¨çš„UUIDå’ŒåŸºäºæ—¶é—´çš„UUIDç®—æ³•ç›¸åŒï¼Œä½†ä¼šæŠŠæ—¶é—´æˆ³çš„å‰4ä½ç½®æ¢ä¸ºPOSIXçš„UIDæˆ–GIDã€‚è¿™ä¸ªç‰ˆæœ¬çš„UUIDåœ¨å®é™…ä¸­è¾ƒå°‘ç”¨åˆ°ã€‚
UUID Version 3ï¼šåŸºäºåå­—çš„UUIDï¼ˆMD5ï¼‰
åŸºäºåå­—çš„UUIDé€šè¿‡è®¡ç®—åå­—å’Œåå­—ç©ºé—´çš„MD5æ•£åˆ—å€¼å¾—åˆ°ã€‚è¿™ä¸ªç‰ˆæœ¬çš„UUIDä¿è¯äº†ï¼šç›¸åŒåå­—ç©ºé—´ä¸­ä¸åŒåå­—ç”Ÿæˆçš„UUIDçš„å”¯ä¸€æ€§ï¼›ä¸åŒåå­—ç©ºé—´ä¸­çš„UUIDçš„å”¯ä¸€æ€§ï¼›ç›¸åŒåå­—ç©ºé—´ä¸­ç›¸åŒåå­—çš„UUIDé‡å¤ç”Ÿæˆæ˜¯ç›¸åŒçš„ã€‚
UUID Version 4ï¼šéšæœºUUID
æ ¹æ®éšæœºæ•°ï¼Œæˆ–è€…ä¼ªéšæœºæ•°ç”ŸæˆUUIDã€‚è¿™ç§UUIDäº§ç”Ÿé‡å¤çš„æ¦‚ç‡æ˜¯å¯ä»¥è®¡ç®—å‡ºæ¥çš„ï¼Œä½†éšæœºçš„ä¸œè¥¿å°±åƒæ˜¯ä¹°å½©ç¥¨ï¼šä½ æŒ‡æœ›å®ƒå‘è´¢æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†ç‹—å±è¿é€šå¸¸ä¼šåœ¨ä¸ç»æ„ä¸­åˆ°æ¥ã€‚
UUID Version 5ï¼šåŸºäºåå­—çš„UUIDï¼ˆSHA1ï¼‰
å’Œç‰ˆæœ¬3çš„UUIDç®—æ³•ç±»ä¼¼ï¼Œåªæ˜¯æ•£åˆ—å€¼è®¡ç®—ä½¿ç”¨SHA1ï¼ˆSecure Hash Algorithm 1ï¼‰ç®—æ³•ã€‚
UUIDçš„åº”ç”¨ä»UUIDçš„ä¸åŒç‰ˆæœ¬å¯ä»¥çœ‹å‡ºï¼Œ
Version 1/2é€‚åˆåº”ç”¨äºåˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸‹ï¼Œå…·æœ‰é«˜åº¦çš„å”¯ä¸€æ€§ï¼›
Version 3/5é€‚åˆäºä¸€å®šèŒƒå›´å†…åå­—å”¯ä¸€ï¼Œä¸”éœ€è¦æˆ–å¯èƒ½ä¼šé‡å¤ç”ŸæˆUUIDçš„ç¯å¢ƒä¸‹ï¼›
è‡³äºVersion 4ï¼Œä¸ªäººçš„å»ºè®®æ˜¯æœ€å¥½ä¸ç”¨ï¼ˆè™½ç„¶å®ƒæ˜¯æœ€ç®€å•æœ€æ–¹ä¾¿çš„ï¼‰ã€‚
é€šå¸¸æˆ‘ä»¬å»ºè®®ä½¿ç”¨UUIDæ¥æ ‡è¯†å¯¹è±¡æˆ–æŒä¹…åŒ–æ•°æ®ï¼Œä½†ä»¥ä¸‹æƒ…å†µæœ€å¥½ä¸ä½¿ç”¨UUIDï¼š
æ˜ å°„ç±»å‹çš„å¯¹è±¡ã€‚æ¯”å¦‚åªæœ‰ä»£ç åŠåç§°çš„ä»£ç è¡¨ã€‚
äººå·¥ç»´æŠ¤çš„éç³»ç»Ÿç”Ÿæˆå¯¹è±¡ã€‚æ¯”å¦‚ç³»ç»Ÿä¸­çš„éƒ¨åˆ†åŸºç¡€æ•°æ®ã€‚
å¯¹äºå…·æœ‰åç§°ä¸å¯é‡å¤çš„è‡ªç„¶ç‰¹æ€§çš„å¯¹è±¡ï¼Œæœ€å¥½ä½¿ç”¨Version 3/5çš„UUIDã€‚æ¯”å¦‚ç³»ç»Ÿä¸­çš„ç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·çš„UUIDæ˜¯Version 1çš„ï¼Œå¦‚æœä½ ä¸å°å¿ƒåˆ é™¤äº†å†é‡å»ºç”¨æˆ·ï¼Œä½ ä¼šå‘ç°äººè¿˜æ˜¯é‚£ä¸ªäººï¼Œç”¨æˆ·å·²ç»ä¸æ˜¯é‚£ä¸ªç”¨æˆ·äº†ã€‚ï¼ˆè™½ç„¶æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†ä¼šå¸¦æ¥å®ç°ä¸Šçš„å¤æ‚æ€§ã€‚ï¼‰

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zhch602.github.io/post/uuid">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zhch602.github.io/post/mysql-cha-xun-xing-neng-you-hua">
                        MySqlæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-04-01</time>
                    
                        <a href="https://zhch602.github.io/tag/9T7Xm-fd4" class="post-tag i-tag
                            i-tag-other_2">
            #mysql
        </a>
                        
                        <a href="https://zhch602.github.io/tag/wntwb2NOX" class="post-tag i-tag
                            i-tag-other_1">
            #æ€§èƒ½ä¼˜åŒ–
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            é¿å…å‘æ•°æ®åº“è¯·æ±‚ä¸éœ€è¦çš„æ•°æ®
åœ¨è®¿é—®æ•°æ®åº“æ—¶ï¼Œåº”è¯¥åªè¯·æ±‚éœ€è¦çš„è¡Œå’Œåˆ—ã€‚è¯·æ±‚å¤šä½™çš„è¡Œå’Œåˆ—ä¼šæ¶ˆè€—MySqlæœåŠ¡å™¨çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¹¶å¢åŠ ç½‘ç»œå¼€é”€ã€‚
ä¾‹å¦‚åœ¨å¤„ç†åˆ†é¡µæ—¶ï¼Œåº”è¯¥ä½¿ç”¨LIMITé™åˆ¶MySqlåªè¿”å›ä¸€é¡µçš„æ•°æ®ï¼Œè€Œä¸æ˜¯å‘åº”ç”¨ç¨‹åºè¿”å›å…¨éƒ¨æ•°æ®åï¼Œå†ç”±åº”ç”¨ç¨‹åºè¿‡æ»¤ä¸éœ€è¦çš„è¡Œã€‚
å½“ä¸€è¡Œæ•°æ®è¢«å¤šæ¬¡ä½¿ç”¨æ—¶å¯ä»¥è€ƒè™‘å°†æ•°æ®è¡Œç¼“å­˜èµ·æ¥ï¼Œé¿å…æ¯æ¬¡ä½¿ç”¨éƒ½è¦åˆ°MySqlæŸ¥è¯¢ã€‚
é¿å…ä½¿ç”¨SELECT *è¿™ç§æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œåº”è¯¥åªè¿”å›éœ€è¦çš„åˆ—ã€‚
æŸ¥è¯¢æ•°æ®çš„æ–¹å¼
æŸ¥è¯¢æ•°æ®çš„æ–¹å¼æœ‰å…¨è¡¨æ‰«æã€ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ã€‚è¿™äº›æŸ¥è¯¢æ–¹å¼ï¼Œé€Ÿåº¦ä»æ…¢åˆ°å¿«ï¼Œæ‰«æçš„è¡Œæ•°ä¹Ÿæ˜¯ä»å¤šåˆ°å°‘ã€‚å¯ä»¥é€šè¿‡EXPLAINè¯­å¥ä¸­çš„typeåˆ—ååº”æŸ¥è¯¢é‡‡ç”¨çš„æ˜¯å“ªç§æ–¹å¼ã€‚
é€šå¸¸å¯ä»¥é€šè¿‡æ·»åŠ åˆé€‚çš„ç´¢å¼•æ”¹å–„æŸ¥è¯¢æ•°æ®çš„æ–¹å¼ï¼Œä½¿å…¶å°½å¯èƒ½å‡å°‘æ‰«æçš„æ•°æ®è¡Œï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚
ä¾‹å¦‚ï¼Œå½“å‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®è¡Œä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå³æŠŠæ‰€æœ‰éœ€è¦ç”¨åˆ°çš„åˆ—éƒ½æ”¾åˆ°ç´¢å¼•ä¸­ã€‚è¿™æ ·å­˜å‚¨å¼•æ“æ— é¡»å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœäº†ã€‚
åˆ†è§£å¤§çš„æŸ¥è¯¢
å¯ä»¥å°†ä¸€ä¸ªå¤§æŸ¥è¯¢åˆ‡åˆ†æˆå¤šä¸ªå°æŸ¥è¯¢æ‰§è¡Œï¼Œæ¯ä¸ªå°æŸ¥è¯¢åªå®Œæˆæ•´ä¸ªæŸ¥è¯¢ä»»åŠ¡çš„ä¸€å°éƒ¨åˆ†ï¼Œæ¯æ¬¡åªè¿”å›ä¸€å°éƒ¨åˆ†ç»“æœ
åˆ é™¤æ—§çš„æ•°æ®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚å¦‚æœåªç”¨ä¸€æ¡è¯­å¥ä¸€æ¬¡æ€§æ‰§è¡Œä¸€ä¸ªå¤§çš„åˆ é™¤æ“ä½œï¼Œåˆ™å¯èƒ½éœ€è¦ä¸€æ¬¡é”ä½å¾ˆå¤šæ•°æ®ï¼Œå æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ï¼Œè€—å°½ç³»ç»Ÿèµ„æºã€é˜»å¡å¾ˆå¤šå°çš„ä½†é‡è¦çš„æŸ¥è¯¢ã€‚å°†ä¸€ä¸ªå¤§çš„åˆ é™¤æ“ä½œåˆ†è§£æˆå¤šä¸ªè¾ƒå°çš„åˆ é™¤æ“ä½œå¯ä»¥å°†æœåŠ¡å™¨ä¸ŠåŸæœ¬ä¸€æ¬¡æ€§çš„å‹åŠ›åˆ†æ•£åˆ°å¤šæ¬¡æ“ä½œä¸Šï¼Œå°½å¯èƒ½å°åœ°å½±å“MySqlæ€§èƒ½ï¼Œå‡å°‘åˆ é™¤æ—¶é”çš„ç­‰å¾…æ—¶é—´ã€‚åŒæ—¶ä¹Ÿå‡å°‘äº†MySqlä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿã€‚
å¦ä¸€ä¸ªä¾‹å­æ˜¯åˆ†è§£å…³è”æŸ¥è¯¢ï¼Œå³å¯¹æ¯ä¸ªè¦å…³è”çš„è¡¨è¿›è¡Œå•è¡¨æŸ¥è¯¢ï¼Œç„¶åå°†ç»“æœåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ã€‚ä¸‹é¢çš„è¿™ä¸ªæŸ¥è¯¢ï¼š
SELECT * FROM tag
    JOIN tag_post ON tag_post.tag_id=tag.id
    JOIN post ON tag_post.post_id=post.id
WHERE tag.tag = &#39;mysql&#39;;

å¯ä»¥åˆ†è§£æˆä¸‹é¢è¿™äº›æŸ¥è¯¢æ¥ä»£æ›¿ï¼š
SELECT * FROM tag WHERE tag = &#39;mysql&#39;;
SELECT * FROM tag_post WHERE tag_id = 1234;
SELECT * FROM post WHERE post.id in (123,456,567,9098,8904);

å°†ä¸€ä¸ªå…³è”æŸ¥è¯¢æ‹†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢æœ‰å¦‚ä¸‹æœ‰ç‚¹ï¼š

è®©ç¼“å­˜çš„æ•ˆç‡æ›´é«˜ã€‚å¦‚æœç¼“å­˜çš„æ˜¯å…³è”æŸ¥è¯¢çš„ç»“æœï¼Œé‚£ä¹ˆå…¶ä¸­çš„ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œæ•´ä¸ªç¼“å­˜å°±å¤±æ•ˆäº†ã€‚è€Œæ‹†åˆ†åï¼Œå¦‚æœåªæ˜¯æŸä¸ªè¡¨å¾ˆå°‘çš„æ”¹åŠ¨ï¼Œå¹¶ä¸ä¼šç ´åæ‰€æœ‰çš„ç¼“å­˜ã€‚
å¯ä»¥å‡å°‘é”çš„ç«äº‰
æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯æ‰©å±•ã€‚
æŸ¥è¯¢æœ¬èº«çš„æ•ˆç‡ä¹Ÿæœ‰å¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚ä¾‹å¦‚ä¸Šé¢ç”¨IN()ä»£æ›¿å…³è”æŸ¥è¯¢æ¯”éšæœºçš„å…³è”æ›´åŠ é«˜æ•ˆã€‚

ä¼˜åŒ–MIN()å’ŒMAX()
æ·»åŠ ç´¢å¼•å¯ä»¥ä¼˜åŒ–MIN()å’ŒMAX()è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œè¦æ‰¾åˆ°æŸä¸€åˆ—çš„æœ€å°å€¼ï¼Œåªéœ€è¦æŸ¥è¯¢å¯¹åº”B-Treeç´¢å¼•çš„æœ€å·¦ç«¯çš„è®°å½•å³å¯ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœè¦æŸ¥è¯¢åˆ—ä¸­çš„æœ€å¤§å€¼ï¼Œä¹Ÿåªéœ€è¦è¯»å–B-Treeç´¢å¼•çš„æœ€åä¸€æ¡è®°å½•ã€‚å¯¹äºè¿™ç§æŸ¥è¯¢ï¼ŒEXPLAINä¸­å¯ä»¥çœ‹åˆ°&amp;quot;Select tables optimized away&amp;quot;,è¡¨ç¤ºä¼˜åŒ–å™¨å·²ç»ä»æ‰§è¡Œè®¡åˆ’ä¸­ç§»é™¤äº†è¯¥è¡¨ï¼Œå¹¶ä»¥ä¸€ä¸ªå¸¸æ•°å–è€Œä»£ä¹‹ã€‚
ç”¨IN()å–ä»£OR
åœ¨MySqlä¸­ï¼ŒIN()å…ˆå°†è‡ªå·±åˆ—è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ’åºï¼Œç„¶åé€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼ç¡®å®šåˆ—çš„å€¼æ˜¯å¦åœ¨IN()çš„åˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯O(logn)ã€‚å¦‚æœæ¢æˆORæ“ä½œï¼Œåˆ™æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚æ‰€ä»¥ï¼Œå¯¹äºIN()çš„åˆ—è¡¨ä¸­æœ‰å¤§é‡å–å€¼çš„æ—¶å€™ï¼Œç”¨IN()æ›¿æ¢ORæ“ä½œå°†ä¼šæ›´å¿«ã€‚
ä¼˜åŒ–å…³è”æŸ¥è¯¢
åœ¨MySqlä¸­ï¼Œä»»ä½•ä¸€ä¸ªæŸ¥è¯¢éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå…³è”æŸ¥è¯¢ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªè¡¨çš„æŸ¥è¯¢ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
MySqlå¯¹ä»»ä½•å…³è”éƒ½æ‰§è¡ŒåµŒå¥—å¾ªç¯çš„å…³è”æ“ä½œï¼Œä¾‹å¦‚å¯¹äºä¸‹é¢çš„SQLè¯­å¥ï¼š
SELECT tbl1.col1,tbl2.col2
FROM tbl1 INNER JOIN tbl2 USING(col3)
WHERE tbl1.col1 IN(5,6);

ä¸‹é¢çš„ä¼ªä»£ç è¡¨ç¤ºMySqlå°†å¦‚ä½•æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼š
//å…ˆä»ç¬¬ä¸€ä¸ªè¡¨ä¸­å–å‡ºç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è¡Œ
out_iter = iterator over tbl1 where col1 IN(5,6)
outer_row = out_iter.next
//åœ¨whileå¾ªç¯ä¸­éå†ç¬¬ä¸€ä¸ªè¡¨ç»“æœé›†çš„æ¯ä¸€è¡Œ
while outer_row
    //å¯¹äºç¬¬ä¸€ä¸ªè¡¨ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œï¼Œåœ¨ç¬¬äºŒä¸ªè¡¨ä¸­æ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è¡Œ
    inner_iter = iterator over tbl2 where col3 = outer_row.col3
    inner_row = inner_iter.next
    while inner_row
        //å°†ç¬¬ä¸€ä¸ªè¡¨çš„ç»“æœåˆ—å’Œç¬¬äºŒä¸ªè¡¨çš„ç»“æœåˆ—æ‹¼è£…åœ¨ä¸€èµ·ä½œä¸ºç»“æœè¾“å‡º
        output[outer_row.col1, inner_row.col2]
        inner_row = inner_iter.next
    end
    //å›æº¯ï¼Œå†æ ¹æ®ç¬¬ä¸€ä¸ªè¡¨ç»“æœé›†çš„ä¸‹ä¸€è¡Œï¼Œç»§ç»­ä¸Šé¢çš„è¿‡ç¨‹
    outer_row = outer_iter.next
end

å¯¹äºå•è¡¨æŸ¥è¯¢ï¼Œé‚£ä¹ˆåªéœ€è¦å®Œæˆä¸Šé¢å¤–å±‚çš„åŸºæœ¬æ“ä½œã€‚
ä¼˜åŒ–å…³è”æŸ¥è¯¢ï¼Œè¦ç¡®ä¿ONæˆ–è€…USINGå­å¥ä¸­çš„åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå¹¶ä¸”åœ¨å»ºç«‹ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘åˆ°å…³è”çš„é¡ºåºã€‚é€šå¸¸æ¥è¯´ï¼Œåªéœ€è¦åœ¨å…³è”é¡ºåºä¸­çš„ç¬¬äºŒä¸ªè¡¨çš„ç›¸åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œå½“è¡¨Aå’Œè¡¨Bç”¨åˆ—cå…³è”çš„æ—¶å€™ï¼Œå‡è®¾å…³è”çš„é¡ºåºæ˜¯Bã€Aï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åœ¨Bè¡¨çš„cåˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚æ²¡æœ‰ç”¨åˆ°çš„ç´¢å¼•åªä¼šå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ã€‚
æ­¤å¤–ï¼Œç¡®ä¿ä»»ä½•çš„GROUP BYå’ŒORDER BYä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚
ä¸´æ—¶è¡¨çš„æ¦‚å¿µ
ä¸Šé¢æåˆ°åœ¨MySqlä¸­ï¼Œä»»ä½•ä¸€ä¸ªæŸ¥è¯¢å®è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªå…³è”æŸ¥è¯¢ã€‚é‚£ä¹ˆå¯¹äºå­æŸ¥è¯¢æˆ–UNIONæŸ¥è¯¢æ˜¯å¦‚ä½•å®ç°å…³è”æ“ä½œçš„å‘¢ã€‚
å¯¹äºUNIONæŸ¥è¯¢ï¼ŒMySqlå…ˆå°†æ¯ä¸€ä¸ªå•è¡¨æŸ¥è¯¢ç»“æœæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œç„¶åå†é‡æ–°è¯»å‡ºä¸´æ—¶è¡¨æ•°æ®æ¥å®ŒæˆUNIONæŸ¥è¯¢ã€‚MySqlè¯»å–ç»“æœä¸´æ—¶è¡¨å’Œæ™®é€šè¡¨ä¸€æ ·ï¼Œä¹Ÿæ˜¯é‡‡ç”¨çš„å…³è”æ–¹å¼ã€‚
å½“é‡åˆ°å­æŸ¥è¯¢æ—¶ï¼Œå…ˆæ‰§è¡Œå­æŸ¥è¯¢å¹¶å°†ç»“æœæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œç„¶åå†å°†è¿™ä¸ªä¸´æ—¶è¡¨å½“åšä¸€ä¸ªæ™®é€šè¡¨å¯¹å¾…ã€‚
MySqlçš„ä¸´æ—¶è¡¨æ˜¯æ²¡æœ‰ä»»ä½•ç´¢å¼•çš„ï¼Œåœ¨ç¼–å†™å¤æ‚çš„å­æŸ¥è¯¢å’Œå…³è”æŸ¥è¯¢çš„æ—¶å€™éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚
ä¸´æ—¶è¡¨ä¹Ÿå«æ´¾ç”Ÿè¡¨ã€‚
æ’åºä¼˜åŒ–
åº”è¯¥å°½é‡è®©MySqlä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºã€‚å½“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ç”Ÿæˆæ’åºç»“æœçš„æ—¶å€™ï¼ŒMySqléœ€è¦è‡ªå·±è¿›è¡Œæ’åºã€‚å¦‚æœæ•°æ®é‡å°äºâ€œæ’åºç¼“å†²åŒºâ€çš„å¤§å°ï¼Œåˆ™MySqlä½¿ç”¨å†…å­˜è¿›è¡Œâ€œå¿«é€Ÿæ’åºâ€æ“ä½œã€‚å¦‚æœæ•°æ®é‡å¤ªå¤§è¶…è¿‡â€œæ’åºç¼“å†²åŒºâ€çš„å¤§å°ï¼Œé‚£ä¹ˆMySqlåªèƒ½é‡‡ç”¨æ–‡ä»¶æ’åºï¼Œè€Œæ–‡ä»¶æ’åºçš„ç®—æ³•éå¸¸å¤æ‚ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºã€‚
æ— è®ºå¦‚ä½•æ’åºéƒ½æ˜¯ä¸€ä¸ªæˆæœ¬å¾ˆé«˜çš„æ“ä½œï¼Œæ‰€ä»¥ä»æ€§èƒ½è§’åº¦è€ƒè™‘ï¼Œåº”å°½å¯èƒ½é¿å…æ’åºã€‚æ‰€ä»¥è®©MySqlæ ¹æ®ç´¢å¼•æ„é€ æ’åºç»“æœéå¸¸çš„é‡è¦ã€‚
å­æŸ¥è¯¢ä¼˜åŒ–
MySqlçš„å­æŸ¥è¯¢å®ç°çš„éå¸¸ç³Ÿç³•ã€‚æœ€ç³Ÿç³•çš„ä¸€ç±»æŸ¥è¯¢æ˜¯WHEREæ¡ä»¶ä¸­åŒ…å«IN()çš„å­æŸ¥è¯¢è¯­å¥ã€‚
åº”è¯¥å°½å¯èƒ½ç”¨å…³è”æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
ä¼˜åŒ–COUNT()æŸ¥è¯¢
COUNT()æœ‰ä¸¤ä¸ªä¸åŒçš„ä½œç”¨ï¼š

ç»Ÿè®¡æŸä¸ªåˆ—å€¼çš„æ•°é‡ï¼Œå³ç»Ÿè®¡æŸåˆ—å€¼ä¸ä¸ºNULLçš„ä¸ªæ•°ã€‚
ç»Ÿè®¡è¡Œæ•°ã€‚

å½“ä½¿ç”¨COUNT(*)æ—¶ï¼Œç»Ÿè®¡çš„æ˜¯è¡Œæ•°ï¼Œå®ƒä¼šå¿½ç•¥æ‰€æœ‰çš„åˆ—è€Œç›´æ¥ç»Ÿè®¡æ‰€æœ‰çš„è¡Œæ•°ã€‚è€Œåœ¨æ‹¬å·ä¸­æŒ‡å®šäº†ä¸€ä¸ªåˆ—çš„è¯ï¼Œåˆ™ç»Ÿè®¡çš„æ˜¯è¿™ä¸ªåˆ—ä¸Šå€¼ä¸ä¸ºNULLçš„ä¸ªæ•°ã€‚
å¯ä»¥è€ƒè™‘ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«ææˆ–å¢åŠ æ±‡æ€»è¡¨å¯¹COUNT()è¿›è¡Œä¼˜åŒ–ã€‚
ä¼˜åŒ–LIMITåˆ†é¡µ
å¤„ç†åˆ†é¡µä¼šä½¿ç”¨åˆ°LIMITï¼Œå½“ç¿»é¡µåˆ°éå¸¸é åçš„é¡µé¢çš„æ—¶å€™ï¼Œåç§»é‡ä¼šéå¸¸å¤§ï¼Œè¿™æ—¶LIMITçš„æ•ˆç‡ä¼šéå¸¸å·®ã€‚ä¾‹å¦‚å¯¹äº**LIMIT 10000ï¼Œ20**è¿™æ ·çš„æŸ¥è¯¢ï¼ŒMySqléœ€è¦æŸ¥è¯¢10020æ¡è®°å½•ï¼Œå°†å‰é¢10000æ¡è®°å½•æŠ›å¼ƒï¼Œåªè¿”å›æœ€åçš„20æ¡ã€‚è¿™æ ·çš„ä»£ä»·éå¸¸é«˜ï¼Œå¦‚æœæ‰€æœ‰çš„é¡µé¢è¢«è®¿é—®çš„é¢‘ç‡éƒ½ç›¸åŒï¼Œé‚£ä¹ˆè¿™æ ·çš„æŸ¥è¯¢å¹³å‡éœ€è¦è®¿é—®åŠä¸ªè¡¨çš„æ•°æ®ã€‚
ä¼˜åŒ–æ­¤ç±»åˆ†é¡µæŸ¥è¯¢çš„ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å°½å¯èƒ½åœ°ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼Œè€Œä¸æ˜¯æŸ¥è¯¢æ‰€æœ‰çš„åˆ—ã€‚ç„¶åæ ¹æ®éœ€è¦ä¸åŸè¡¨åšä¸€æ¬¡å…³è”æ“ä½œè¿”å›æ‰€éœ€çš„åˆ—ã€‚å¯¹äºåç§»é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿™æ ·çš„æ•ˆç‡ä¼šæå‡éå¸¸å¤§ã€‚è€ƒè™‘ä¸‹é¢çš„æŸ¥è¯¢ï¼š
SELECT film_id, description FROM sakila.film ORDER BY title LIMIT 50, 5;

å¦‚æœè¿™ä¸ªè¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢æœ€å¥½æ”¹å†™æˆä¸‹é¢çš„è¿™æ ·å­ï¼š
SELECT film.film_id, film.description FROM sakila.film
INNER JOIN 
(SELECT film_id FROM sakila.film ORDER BY title LIMIT 50,5) AS lim
USING(film_id);

æ³¨æ„ä¼˜åŒ–ä¸­å…³è”çš„å­æŸ¥è¯¢ï¼Œå› ä¸ºåªæŸ¥è¯¢film_idä¸€ä¸ªåˆ—ï¼Œæ•°æ®é‡å°ï¼Œä½¿å¾—ä¸€ä¸ªå†…å­˜é¡µå¯ä»¥å®¹çº³æ›´å¤šçš„æ•°æ®ï¼Œè¿™è®©MySQLæ‰«æå°½å¯èƒ½å°‘çš„é¡µé¢ã€‚åœ¨è·å–åˆ°æ‰€éœ€è¦çš„æ‰€æœ‰è¡Œä¹‹åå†ä¸åŸè¡¨è¿›è¡Œå…³è”ä»¥è·å¾—éœ€è¦çš„å…¨éƒ¨åˆ—ã€‚
LIMITçš„ä¼˜åŒ–é—®é¢˜ï¼Œå…¶å®æ˜¯OFFSETçš„é—®é¢˜ï¼Œå®ƒä¼šå¯¼è‡´MySqlæ‰«æå¤§é‡ä¸éœ€è¦çš„è¡Œç„¶åå†æŠ›å¼ƒæ‰ã€‚å¯ä»¥å€ŸåŠ©ä¹¦ç­¾çš„æ€æƒ³è®°å½•ä¸Šæ¬¡å–æ•°æ®çš„ä½ç½®ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥ä»è¯¥ä¹¦ç­¾è®°å½•çš„ä½ç½®å¼€å§‹æ‰«æï¼Œè¿™æ ·å°±é¿å…äº†ä½¿ç”¨OFFSETã€‚å¯ä»¥æŠŠä¸»é”®å½“åšä¹¦ç­¾ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ï¼š
SELECT * FROM sakila.rental ORDER BY rental_id DESC LIMIT 20;

å‡è®¾ä¸Šé¢çš„æŸ¥è¯¢è¿”å›çš„æ˜¯ä¸»é”®ä¸º16049åˆ°16030çš„ç§Ÿå€Ÿè®°å½•ï¼Œé‚£ä¹ˆä¸‹ä¸€é¡µæŸ¥è¯¢å°±å¯ä»¥ç›´æ¥ä»16030è¿™ä¸ªç‚¹å¼€å§‹ï¼š
SELECT * FROM sakila.rental WHERE rental_id &amp;lt; 16030
ORDER BY rental_id DESC LIMIT 20;

è¯¥æŠ€æœ¯çš„å¥½å¤„æ˜¯æ— è®ºç¿»é¡µåˆ°å¤šä¹ˆåé¢ï¼Œå…¶æ€§èƒ½éƒ½ä¼šå¾ˆå¥½ã€‚
æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨å…³è”åˆ°ä¸€ä¸ªå†—ä½™è¡¨çš„æ–¹å¼æé«˜LIMITçš„æ€§èƒ½ï¼Œå†—ä½™è¡¨åªåŒ…å«ä¸»é”®åˆ—å’Œéœ€è¦åšæ’åºçš„æ•°æ®åˆ—ã€‚
ä¼˜åŒ–UNIONæŸ¥è¯¢
é™¤éç¡®å®éœ€è¦æœåŠ¡å™¨æ¶ˆé™¤é‡å¤çš„è¡Œï¼Œå¦åˆ™ä¸€å®šè¦ä½¿ç”¨UNION ALLã€‚å¦‚æœæ²¡æœ‰ALLå…³é”®å­—ï¼ŒMySqlä¼šç»™ä¸´æ—¶è¡¨åŠ ä¸ŠDISTINCTé€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å¯¹æ•´ä¸ªä¸´æ—¶è¡¨çš„æ•°æ®åšå”¯ä¸€æ€§æ£€æŸ¥ã€‚è¿™æ ·åšçš„ä»£ä»·éå¸¸é«˜ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zhch602.github.io/post/mysql-cha-xun-xing-neng-you-hua">Read More ~</a>
                            </div>
                </div>
            </article>
            
                <!-- ç¿»é¡µ -->
                
                </div>
                <!--  -->
                <div class="main-container-middle"></div>
                <!--  -->
                <div id="sidebar" class="main-container-right">

                    <!-- ä¸ªäººä¿¡æ¯ -->
                    
    <div class="id_card i-card">
        <div class="id_card-avatar" style="background-image: url(https://zhch602.github.io/images/avatar.png?v=1573736033730)">
        </div>
        <h1 class="id_card-title">
            InJune&#39;s Blog
        </h1>
        <h2 class="id_card-description">
            æ¸©æ•…è€ŒçŸ¥æ–°
        </h2>
        <!--  -->
        <div class="id_card-sns">
            <!-- github -->
            
                <a href="https://github.com/zhch602" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-github"></i></a>
                
                    <!-- twitter -->
                    
                        <a href="https://twitter.com/zhch602" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-twitter"></i></a>
                        
                            <!-- weibo -->
                            
                                <a href="https://weibo.com/5207780273" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-weibo"></i></a>
                                
                                    <!-- facebook -->
                                    
                                        <a href="https://www.facebook.com/zhch602" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-facebook"></i></a>
                                        

        </div>
    </div>
    

                        <!-- å…¬å‘Šæ  -->
                        

                </div>
            </div>



            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://zhch602.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
</body>

</html>